function Arethusa(){function a(a){var b=this,c=a.get("$compile");this.configurator=a.get("configurator"),this.configure=function(a){b.configurator.defineConfiguration(a)},this.watchUrl=function(b){a.get("locator").watchUrl(b)},this.setBasePath=function(b){a.get("basePath").set(b)},this.setParams=function(b,c){a.get("locator").set(b,c)},this.compile=function(a){var b=a[0].innerHTML;a.html(c(b)(a.scope()))},this.state=a.get("state")}var b=this;b.basePath="..",this.setConfPath=function(a){angular.module("arethusa").value("CONF_PATH",a)},this.setBasePath=function(a){b.basePath=a,angular.module("arethusa.core").value("BASE_PATH",a)},this.start=function(b,c,d){var e={};b=b.match(/^#/)?b:"#"+b;var f=angular.element(b);return f.attr("ng-controller","ArethusaCtrl"),f.ready(function(){var g=angular.bootstrap(b,["arethusa"]),h=new a(g);h.watchUrl(!1),h.setParams(d),h.configure(c),h.compile(f),angular.extend(e,h)}),e}}angular.module("arethusa.util",[]),angular.module("arethusa.util").service("commons",[function(){function a(a,b,c){this.label=a,this.model=b,this.change=c}function b(a,b,c){this.xml=a,this.json=b,this.conf=c}function c(a,b){var c=this;this.tokens=a,this.cite=b||"",this.toString=function(){return arethusaUtil.inject([],c.tokens,function(a,b,c){a.push(c.string)}).join(" ")}}function d(a,b,c,d,e){this.class=a,this.role=b,this.id=c,this.sentenceId=d,this.parent=e,this.isConstituent=!0}function e(a,b){this.string=a,this.sentenceId=b,this.isToken=!0}this.setting=function(b,c,d){return new a(b,c,d)},this.doc=function(a,c,d){return new b(a,c,d)},this.sentence=function(a,b){return new c(a,b)},this.constituent=function(a,b,c,e,f){return new d(a,b,c,e,f)},this.token=function(a,b){return new e(a,b)}}]),angular.module("arethusa.util").service("generator",[function(){this.panelTrigger=function(a){return{restrict:"A",compile:function(b){function c(a){var c=a;d&&(c+=" ("+d+")"),b.attr("title",c)}var d;return function(b,e){function f(){e.toggleClass("on"),a.service.toggle()}function g(){b.$$phase?f():b.$apply(f)}if(a.trsl(a.trslKey,c),e.bind("click",g),a.kC){var h=a.kC.initCaptures(function(b){var c={};return c[a.mapping.name]=[b.create("toggle",function(){g()},a.mapping.key)],c});d=h[a.mapping.name].toggle}}},template:a.template}},this.historyTrigger=function(a,b,c,d){return d=d||c,{restrict:"A",scope:{},link:function(d,e){function f(){e.attr("title",g+" "+h)}d.history=a,d.$watch("history.mode",function(a){"editor"===a?e.show():e.hide()}),d.$watch("history.can"+aU.capitalize(c),function(a){a?e.removeClass("disabled"):e.addClass("disabled")}),e.bind("click",function(){d.$apply(a[c]())});var g,h;d.$on("keysAdded",function(a,b){var d=b.history;d&&(h=aU.formatKeyHint(d[c]),f())}),b("history."+c,function(a){g=a,f()})},template:'<i class="fa fa-'+d+'"/>'}}}]);var arethusaUtil={formatNumber:function(a,b){var c=parseInt(a,10);if(isNaN(c))return a;for(var d=""+c;d.length<b;)d="0"+d;return d},formatKeyHint:function(a){return a?"("+a+")":""},map:function(a,b){if("object"==typeof b){var c=b;b=function(a){return c[a]}}if("string"==typeof b){var d=b;b=function(a){return a[d]}}var e=[];return a.forEach(function(a){e.push(b(a))}),e},inject:function(a,b,c){if(arethusaUtil.isArray(b))b.forEach(function(b){c(a,b)});else for(var d in b)c(a,d,b[d]);return a},flatten:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];(d||d===!1)&&b.push(d)}return b},pushAll:function(a,b){return a.push.apply(a,b),a},findObj:function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(b(d))return d}},findNestedProperties:function(a,b){var c=arethusaUtil.toAry(b);return arethusaUtil.inject({},c,function(b,c){var d=function(a,b){var c=[];a.hasOwnProperty(b)&&c.push(a);for(var e in a){var f=a[e];"object"==typeof f&&(f=d(f,b))&&arethusaUtil.pushAll(c,f)}return c};b[c]=d(a,c)})},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},toAry:function(a){return a?arethusaUtil.isArray(a)?a:[a]:[]},intersect:function(a,b){function c(a){return arethusaUtil.isIncluded(b,a)}var d;return a.length<b.length&&(d=b,b=a,a=d),a.filter(c)},isIncluded:function(a,b){return-1!==a.indexOf(b)},empty:function(a){if(arethusaUtil.isArray(a))a.splice(0,a.length);else for(var b in a)a.hasOwnProperty(b)&&delete a[b]},last:function(a){return a[a.length-1]},replaceAt:function(a,b,c){return a.substring(0,b)+c+a.substring(b+1)},isTerminatingPunctuation:function(a){return a.match(/^[\.;:]$/)},xmlParser:new X2JS,xml2json:function(a){return arethusaUtil.xmlParser.xml_str2json(a)},json2xml:function(a){return arethusaUtil.xmlParser.json2xml_str(a)},formatXml:function(a){var b,c="",d="",e=/(>)(<)(\/*)/g;a=a.toString().replace(e,"$1\r\n$2$3");var f=0,g=a.split("\r\n");for(var h in g){var i=g[h],j=0;i.match(/.+<\/\w[^>]*>$/)?j=0:i.match(/^<\/\w/)?0!==f&&(f-=1):j=i.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var k="",l=0;f>l;l++)k+="  ";b=!1;var m=i.match(/<\/(\w*)>/,"$1");if(m){var n=m[1],o=new RegExp("<"+n);d.match(o)&&(c=c.substring(0,c.length-3)+"/>\r\n",b=!0)}b||(c+=k+i+"\r\n"),d=i,f+=j}return c},getProperty:function(a,b){for(var c=b.split("."),d=0;d<c.length&&(a=a[c[d]],a);d++);return a},setProperty:function(a,b,c){for(var d=b.split("."),e=d.pop(),f=0;f<d.length;f++){var g=d[f],h=a[g];a=h?h:a[g]={}}a[e]=c},copySelection:function(a,b){var c;return arethusaUtil.inject({},b,function(b,d){c=arethusaUtil.getProperty(a,d),angular.isObject(c)&&(c=angular.copy(c)),arethusaUtil.setProperty(b,d,c)})},percentToRgb:function(a,b){var c,d,e=Math.floor(120*(100-a)/100),f=b||1,g=1,h=[];switch(e/=60,d=Math.floor(e),h=[g*(1-f),g*(1-f*(e-d)),g*(1-f*(1-(e-d)))],d){case 0:c=[g,h[2],h[0]];break;case 1:c=[h[1],g,h[0]];break;case 2:c=[h[0],g,h[2]];break;case 3:c=[h[0],h[1],g];break;case 4:c=[h[2],h[0],g];break;default:c=[g,h[0],h[1]]}return"#"+c.map(function(a){return("0"+Math.round(255*a).toString(16)).slice(-2)}).join("")},toPercent:function(a,b){return b/a*100},resolveFn:function(a){return function(){a.resolve()}},rejectFn:function(a){return function(){a.reject()}},isArethusaMainApplication:function(){var a=document.querySelector("html").attributes["ng-app"];return a&&"arethusa"==a.value},isUrl:function(a){return a.match(/^http:\/\//)},capitalize:function(a){return a[0].toUpperCase()+a.slice(1)},find:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];if(b(e)){c=e;break}}return c},unique:function(a,b){for(var c=[],d=0;d<a.length;d++){for(var e=a[d],f=!0,g=a.length-1;g>=d+1;g--){var h=a[g];if(b(e,h)){f=!1;break}}f&&c.push(e)}return c}},aU=arethusaUtil;angular.module("arethusa.util").service("logger",[function(){this.log=function(a){console.log(a)}}]),angular.module("arethusa.core",["arethusa.util","ngResource","ngCookies","ngAnimate","duScroll","pascalprecht.translate","toaster","oc.lazyLoad","gridster","hljs","LocalStorageModule"]).value("BASE_PATH","..").constant("_",window._),angular.module("arethusa.core").animation(".slider",["$timeout",function(a){function b(b){function c(){b.height(f+"px"),e>f&&a(function(){f+=h,c()},g)}var d=500,e=b[0].clientHeight,f=0,g=d/30,h=e/g;c()}function c(a,b){angular.element(a).slideUp(500,b)}return{enter:b,leave:c,addClass:function(a,b,d){"ng-hide"===b&&c(a,d)},removeClass:function(a,c,d){"ng-hide"===c&&b(a,d)}}}]),angular.module("arethusa.core").controller("ArethusaCtrl",["$scope","configurator","state","documentStore","notifier","saver","history","plugins","translator","$timeout","globalSettings",function(a,b,c,d,e,f,g,h,i,j,k){function l(){d.reset(),a.aU=arethusaUtil,a.debug=!1,a.toggleDebugMode=function(){a.debug=!a.debug};var i=b.configurationFor("main");a.state=c,a.plugins=h,a.gS=k,j(function(){e.init(),e.wait(m.loadInProgress),c.arethusaLoaded=!1,c.init(),f.init(),g.init()}),a.$on("stateLoaded",function(){c.postInit(),c.arethusaLoaded?h.init():a.init()}),a.init=function(){h.start(i.plugins).then(function(){c.arethusaLoaded=!0,e.success(m.loadComplete),aU.isArethusaMainApplication()&&UserVoice.push(["addTrigger","#uservoicebutton",{mode:"contact"}]),c.silent=!1})}}var m={};i("loadInProgress",m,"loadInProgress"),i("loadComplete",m,"loadComplete"),a.$on("confLoaded",l)}]),angular.module("arethusa.core").service("arethusaGrid",["gridsterConfig","$window","plugins","$rootScope","notifier","globalSettings",function(a,b,c,d,e,f){function g(a,b,c,d){return b=b||[],c=c||[],{sizeX:b[0],sizeY:b[1],row:c[0],col:c[1],plugin:a,style:d}}function h(a){for(var b,c=n.items.length-1;c>=0;c--){var d=n.items[c];if(d.plugin===a){b=d;break}}return b}function i(a,b){b.grid&&(j(),m())}function j(){n.items=arethusaUtil.map(f.layout.grid,function(a){return new g(a.plugin,a.size,a.position,a.style)})}function k(){n.itemList=arethusaUtil.inject({},c.all,function(a,b){a[b]=!1})}function l(){angular.forEach(n.items,function(a){n.itemList[a.plugin]=!0})}function m(){k(),l()}var n=this,o=angular.element(b);this.settings={dragging:!0,resizing:!0,pushing:!0,floating:!0},this.setDragging=function(a){n.options.draggable.enabled=a},this.setResizing=function(a){n.options.resizable.enabled=a},this.setPushing=function(a){n.options.pushing=a},this.setFloating=function(a){n.options.floating=a},this.options=angular.extend(a,{columns:48,rowHeight:"match",defaultSizeX:6,defaultSizeY:4,resizable:{enabled:n.settings.resizing,handles:["n","e","s","w","ne","nw","se","sw"],stop:function(){o.triggerHandler("resize")}},draggable:{enabled:n.settings.dragging,handle:".drag-handle"}}),this.addItem=function(a){n.items.push(new g(a)),e.success(a+" added to the grid!")},this.removeItem=function(a){var b=n.items.indexOf(h(a));n.items.splice(b,1),e.info(a+" removed from grid!")},this.toggleItem=function(a){n.itemList[a]?n.addItem(a):n.removeItem(a)},this.init=function(){d.$on("layoutChange",i),i(null,f.layout)},j(),d.$on("pluginsLoaded",n.init),c.loaded&&n.init()}]),angular.module("arethusa.core").service("arethusaLocalStorage",["localStorageService",function(a){function b(a){return-1===c.indexOf(a)?a:JSON.parse(a)}this.get=function(c){return b(a.get(c))},this.set=a.set;var c=["true","false","null"]}]),angular.module("arethusa.core").directive("arethusaTabs",["plugins",function(a){return{restrict:"A",scope:{tabs:"=arethusaTabs"},link:function(b){b.plugins=a},templateUrl:"templates/arethusa.core/arethusa_tabs.html"}}]),angular.module("arethusa.core").factory("Auth",["$resource","$cookies","$timeout","$injector","translator",function(a,b,c,d,e){function f(){return i||(i=d.get("notifier")),i}function g(b,c){if(b){var d=a(b,null,{get:{withCredentials:c}});this.checkAuth=function(a,b){d.get(a,b)}}else this.checkAuth=function(a){a()}}function h(){}var i,j={};return e("auth.notLoggedIn",j,"notLoggedIn"),function(a,d){function e(){return arethusaUtil.isIncluded(n,d())}function i(){m=!0,f().warning(j.notLoggedIn,null,500)}function k(a){403===a.status&&i()}var l=this;l.conf=a;var m,n=a.skipModes||[];this.withCredentials=a.crossDomain?!0:!1;var o=new g(a.ping,this.withCredentials);this.checkAuthentication=function(){e()||o.checkAuth(h,k)},this.withAuthentication=function(a,b){var d=function(b){k(b),a.reject(b)},f=function(b){m=!1,a.resolve(b)},g=function(){b().then(f,d)};if(!m||e())g();else{var h=function(){c(g,150)};o.checkAuth(h,d)}},this.transformRequest=function(a){"CSRF"==l.conf.type&&(a()[l.conf.header]=b[l.conf.cookie])}}}]),angular.module("arethusa.core").factory("confUrl",["CONF_PATH","$route",function(a,b){return function(c){var d=b.current.params,e=a+"/";return d.conf?e+d.conf+".json":d.conf_file?d.conf_file:c?e+"default.json":void 0}}]),angular.module("arethusa.core").service("configurator",["$injector","$http","$rootScope","Resource","Auth","$timeout","$location","$q",function(a,b,c,d,e,f,g,h){function i(){return a.get("notifier")}function j(){return v||(v=a.get("userPreferences")),v}function k(a){return a.match("^http://")?a:"http://services.perseids.org/arethusa-configs/"+a+".json"}function l(){this.main={},this.plugins={},this.resources={}}function m(a,b){angular.forEach(w,function(c){var d=a[c],e=b[c];e&&o(c,d,e,a)});var c=a.main,d=b.main;d&&angular.extend(c,d)}function n(a,b){var c=a.plugins,d=b.plugins;d&&angular.forEach(d,function(b,d){var e=c[d];o(d,e,b,a)})}function o(a,b,c,d){b?angular.extend(b,c):d[a]=c}function p(a){angular.forEach(q(),function(b,c){void 0===a[c]&&(a[c]=b)})}function q(){var a=r(),b=s();return angular.extend({},y,a,b)}function r(){return u.configuration.main.globalDefaults||{}}function s(){return arethusaUtil.inject({},z,function(a,b){var c=g.search()[b];c&&(a[b]=c)})}function t(){return u.configuration.auths||{}}var u=this;this.configuration=new l;var v;this.defineConfiguration=function(a,b){this.configuration=angular.extend(new l,a),this.confFileLocation=b,f(function(){c.$broadcast("confLoaded")})},this.loadAdditionalConf=function(a){var c=arethusaUtil.inject([],a,function(a,c,d){var e;if("fullFile"==c){var f=function(a){u.shallowMerge(u.configuration,a.data),i().info(d+" configuration loaded!")},g=function(){i().warning("Failed to retrieve "+d)};e=b.get(k(d)).then(f,g)}else e=b.get(d).then(function(a){angular.extend(u.configurationFor(c),a.data)});a.push(e)});return h.all(c)},this.getConfTemplate=function(){return new l},this.mergeConfigurations=function(a,b){var c=this;return angular.forEach(b,function(b,d){var e=a[d];e?angular.isArray(e)?arethusaUtil.pushAll(e,b):angular.isObject(e)?c.mergeConfigurations(e,b):a[d]=b:a[d]=b}),a};var w=["main","navbar","notifier"];this.shallowMerge=function(a,b){return m(a,b),n(a,b),a},this.getService=function(b){return a.get(b)},this.getServices=function(a){if(a){var b=this;return arethusaUtil.inject({},a,function(a,c){a[c]=b.getService(c)})}return{}},this.configurationFor=function(a){var b=u.configuration;return b[a]||b.plugins[a]||b.resources[a]||{}};var x=["displayName","main","template","external","contextMenu","contextMenuTemplate","noView","mode"];this.delegateConf=function(a,b,c){var d=c?b:arethusaUtil.pushAll(x,b),e=a.defaultConf||{},f=function(a){return void 0!==a&&null!==a};angular.forEach(d,function(b){if(!c||!f(a[b])){var d=j().get(a.name,b),g=a.conf[b],h=f(d)?d:f(g)?g:e[b];a[b]=h}}),a.displayName||(a.displayName=a.name),p(a)};var y={mode:"editor"},z=["mode"];this.mode=function(){return q().mode},this.getConfAndDelegate=function(a,b){return a.conf=u.configurationFor(a.name),u.delegateConf(a,b),a},this.getStickyConf=function(a,b){return a.conf=u.configurationFor(a.name),u.delegateConf(a,b,!0),a},this.getRetrievers=function(a){return arethusaUtil.inject({},a,function(a,b,c){var d=u.getService(b);a[b]=new d(c)})},this.getPersisters=this.getRetrievers,this.getRetriever=function(a){var b=u.getRetrievers(a);return b[Object.keys(b)[0]]},this.provideResource=function(a){var b=u.configuration.resources[a];if(b)return new d(b,u.provideAuth(b.auth))},this.provideAuth=function(a){return new e(t()[a]||{},u.mode)},this.addPluginConf=function(a,b){u.configuration.plugins[a]=b}}]),angular.module("arethusa.core").service("dependencyLoader",["$ocLazyLoad","$q","BASE_PATH",function(a,b,c){function d(a){return aU.isUrl(a)?a:c+"/"+a}function e(a){if(angular.isArray(a))return aU.map(a,d);if(angular.isString(a))return d(a);var b=aU.map(a.files,d);return a.files=b,a}this.load=function(b){return a.load(e(b))},this.loadInOrder=function(c){var d=b.defer(),f=[d.promise];return angular.forEach(c,function(c,d){var g=b.defer();f.push(g.promise),f[d].then(function(){a.load(e(c))["finally"](aU.resolveFn(g))})}),d.resolve(),aU.last(f)}}]),angular.module("arethusa.core").directive("arethusaGrid",["arethusaGrid","plugins","globalSettings","$timeout",function(a,b,c,d){return{restrict:"A",scope:!0,link:function(b){function e(){c.defineSetting("grid","custom","grid-setting"),c.defineSetting("gridItems","custom","grid-items")}function f(){c.removeSetting("grid"),c.removeSetting("gridItems")}angular.element(document.body).css("overflow","auto"),b.grid=a,d(e),b.$on("$destroy",f)},templateUrl:"templates/arethusa.core/arethusa_grid.html"}}]),angular.module("arethusa.core").directive("arethusaGridHandle",["$timeout","plugins",function(a,b){return{restrict:"E",scope:!0,link:function(c,d){function e(){h=a(function(){c.visible=!0},100)}function f(){a.cancel(h)}function g(){c.$apply(function(){c.visible=!1})}var h,i=d.find(".drag-handle-trigger"),j=d.find(".drag-handle");i.bind("mouseenter",e),i.bind("mouseleave",f),j.bind("mouseleave",g),c.$on("pluginsLoaded",function(){c.plugin=b.get(c.item.plugin)}),c.$watch("visible",function(a){a||(c.settingsOn=!1)})},templateUrl:"templates/arethusa.core/arethusa_grid_handle.html"}}]),angular.module("arethusa.core").directive("arethusaNavbar",["configurator","$window",function(a,b){return{restrict:"AE",scope:!0,link:function(c){function d(){e(),f()}function e(){c.windowWidth=h.width()}function f(){var a=c.windowWidth>1250?"":"icon-";c.logo="images/arethusa-"+a+"small.png"}var g=a.configurationFor("navbar"),h=angular.element(b);d(),h.on("resize",d),c.template=g.template,c.disable=g.disable,c.showSearch=function(){return g.search},c.showNavigation=function(){return g.navigation},angular.element(document.body).css({padding:"45px"})},template:'<div ng-if="!disable" ng-include="template"></div>'}}]),angular.module("arethusa.core").directive("arethusaUser",[function(){return{restrict:"A",scope:{user:"=arethusaUser",withMail:"@"},link:function(a){function b(){var b="",c=a.user;c.fullName?(b+=c.fullName,c.name&&(b+=" ("+c.name+")")):b+=c.name,a.name=b}b()},templateUrl:"templates/arethusa.core/arethusa_user.html"}}]),angular.module("arethusa.core").directive("chunkModeSwitcher",["navigator","notifier","translator",function(a,b,c){return{restrict:"A",scope:{},link:function(d){d.navi=a;var e={};c("navigator.chunkSizeError",e,"chunkSizeError"),d.$watch("navi.chunkSize",function(a){d.size=a}),d.tryToSetChunkSize=function(){var c=d.size;a.chunkSize!==c&&(1>c||c>5?(b.error(e.chunkSizeError),d.size=a.chunkSize):a.changeChunkSize(d.size))}},templateUrl:"templates/arethusa.core/chunk_mode_switcher.html"}}]),angular.module("arethusa.core").directive("colorizerSetting",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b){b.gS=a,b.$watch("gS.settings.colorizer",function(a){b.setting=a})},templateUrl:"templates/arethusa.core/colorizer_setting.html"}}]),angular.module("arethusa.core").directive("debug",function(){return{restrict:"A",link:function(a,b,c){var d;a.$watch(c.debug,function(a){d=a}),a.$watch("debug",function(a){a?b.show():b.hide()}),a.prettyTokens=function(){return JSON.stringify(d,null,2)}},template:"<pre>{{ prettyTokens() }}</pre>"}}),angular.module("arethusa.core").directive("delimiter",function(){return{restrict:"A",replace:!0,template:'<div class="small-12 columns" style="padding: 0.5rem 0"/>'}}),angular.module("arethusa.core").directive("deselector",["state","translator",function(a,b){return{restrict:"AE",scope:{},link:function(c,d){function e(){d.attr("title",f+" "+g)}d.bind("click",function(){a.deselectAll(),c.$apply()});var f,g;c.$on("keysAdded",function(a,b){var c=b.selections;c&&(g=aU.formatKeyHint(c.deselect),e())}),b("deselectAll",function(a){f=a,e()})},template:'<i class="fi-unlock"/>'}}]),angular.module("arethusa.core").directive("dynamicDirective",["$compile",function(a){return{restrict:"A",scope:{directive:"@dynamicDirective"},link:function(b,c){var d=c[0].tagName.toLowerCase(),e="<"+d+" "+b.directive+"></"+d+">";c.append(a(e)(b.$parent))}}}]),angular.module("arethusa.core").directive("editors",["editors",function(a){return{restrict:"A",scope:{},link:function(b){b.editors=a},templateUrl:"templates/arethusa.core/editors.html"}}]),angular.module("arethusa.core").directive("exit",["exitHandler","translator",function(a,b){return{restrict:"A",scope:{},link:function(c,d){a.defined?(d.bind("click",function(b){var c,d=b.button;0===d&&(c="_self"),1===d&&(c="_blank"),a.leave("_self")}),b("exitHandler.exitTo",function(b){d.attr("title",[b.start,a.title,b.end].join(" "))},null,!0)):d.hide()},template:'<i class="fa fa-sign-out"></i>'}}]),angular.module("arethusa.core").directive("fireEvent",["state",function(a){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,d){var e=b.$eval(d.fireEvent),f=b[e.target],g=b[e.property];b.$watch(e.value,function(b,c){c!==b&&a.fireEvent(f,g,c,b)})}]}}]),angular.module("arethusa.core").directive("focusMe",[function(){return{restrict:"A",scope:{focus:"=focusMe"},link:function(a,b){a.$watch("focus",function(a){a&&b.focus()})}}}]),angular.module("arethusa.core").directive("foreignKeys",["keyCapture","languageSettings","$compile","globalSettings",function(a,b,c,d){return{restrict:"A",scope:{ngChange:"&",ngModel:"@",foreignKeys:"="},link:function(e,f){function g(){return(b.getFor("treebank")||b.getFor("hebrewMorph")||{}).lang}function h(){return e.foreignKeys||g()}function i(){return b.langNames[h()]}function j(){var a=i(),b=e.enabled?"enabled":"disabled";return a?a+" input "+b+"!":""}function k(a){e.$broadcast("convertingKey",a.keyCode)}function l(a,b){angular.forEach(b,function(b){a.append(c(b)(e))})}function m(){if(i()){var a=f.parent(),b=f.css("margin"),c='<span ng-click="visible = !visible">⌨</span>',d='            <span              ng-click="enabled = !enabled"              class="settings-span-button">              <i                ng-class="togglerClass()"                class="fa fa-power-off"/>            </span>          ',e="<div foreign-keys-help/>",g='<div style="margin: '+b+'"/>';f.css("margin",0),l(a,[c,d,e]),a.append(g)}}function n(a,b,c){a.$eval(e.ngModel+" = i + k",{i:b,k:c}),e.ngChange()}e.enabled=!d.keyboardMappings,e.element=f;var o=e.$parent;e.togglerClass=function(){return e.enabled?"success-message-dark":"error-message-dark"},f.attr("placeholder",j),m(),e.parseEvent=function(b,c){var d=f[0].value,g=h();if(g){var i=a.getForeignKey(b,g);return i===!1?(k(b),!1):void 0===i?!0:(k(b),f.value=d+i,c?n(o,d,i):e.$apply(n(o,d,i)),!1)}return!0},e.$watch("enabled",function(a){a?f.bind("keydown",e.parseEvent):f.unbind("keydown",e.parseEvent),f.attr("placeholder",j)})}}}]),angular.module("arethusa.core").directive("foreignKeysHelp",["keyCapture","languageSettings","$timeout",function(a,b,c){return{restrict:"AE",scope:!0,link:function(d,e){function f(){var c=(b.getFor("treebank")||b.getFor("hebrewMorph")||{}).lang;d.keys=a.mappedKeyboard(c,d.shifted)}function g(){d.$apply(function(){d.shifted=!d.shifted,f()})}function h(a){this.keyCode=a,this.shiftKey=d.shifted}function i(b,c){"shift"===a.codeToKey(b.keyCode)&&d.$apply(function(){d.shifted=c,f()})}var j,k=!1,l=d.$watch("visible",function(a){a&&!k&&(j=e.find(".shifter"),j.bind("click",g),l())});d.$watch("shifted",function(a){j&&(a?j.addClass("key-hit"):j.removeClass("key-hit"))}),d.$on("convertingKey",function(b,e){if(d.visible){var f=document.getElementById(a.codeToKey(e)),g=angular.element(f);g.addClass("key-hit"),c(function(){g.removeClass("key-hit")},450)}}),d.element.on("keydown",function(a){i(a,!0)}),d.element.on("keyup",function(a){i(a,!1)}),d.generate=function(b){var c=a.keyToCode(b);d.parseEvent(new h(c),!0),d.shifted=!1,f()},f()},templateUrl:"./templates/arethusa.core/foreign_keys_help.html"}}]),angular.module("arethusa.core").directive("fullHeight",["$window",function(a){return{restrict:"A",link:function(b,c,d){function e(){var a=g.height();c.height(a-h-i)}var f=angular.element(a),g=angular.element(document.body),h=(angular.element(document.getElementById("canvas-border")).height(),c.css("margin-bottom").replace("px","")),i=d.fullHeight||0;f.bind("resize",function(){e()}),e()}}}]),angular.module("arethusa.core").directive("globalClickAction",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b){b.gS=a,b.setting=a.settings.clickAction},templateUrl:"templates/arethusa.core/global_click_action.html"}}]),angular.module("arethusa.core").directive("globalSettingsPanel",["globalSettings","keyCapture","$timeout",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e){d.gS=a,d.kC=b,d.$watch("gS.active",function(a){d.active=a,c(function(){a?e.slideDown():e.slideUp()})})},templateUrl:"templates/arethusa.core/global_settings_panel.html"}}]),angular.module("arethusa.core").directive("globalSettingsTrigger",["generator","globalSettings","translator","keyCapture",function(a,b,c,d){return a.panelTrigger({service:b,trsl:c,trslKey:"globalSettings.title",template:'<i class="fi-widget"/>',kC:d,mapping:{name:"globalSettings",key:"S"}})}]),angular.module("arethusa.core").directive("gridItems",["arethusaGrid","plugins",function(a,b){return{restrict:"A",scope:{},link:function(c){c.grid=a,c.plugins=b},templateUrl:"templates/arethusa.core/grid_items.html"}}]),angular.module("arethusa.core").directive("gridSetting",["arethusaGrid",function(a){return{restrict:"A",scope:{},link:function(b){b.grid=a,b.settings=a.settings;var c=["dragging","resizing","floating","pushing"];angular.forEach(c,function(c){b.$watch("settings."+c,function(b,d){b!==d&&a["set"+aU.capitalize(c)](b)})})},templateUrl:"templates/arethusa.core/grid_setting.html"}}]),angular.module("arethusa.core").directive("helpPanel",["help","keyCapture","globalSettings","versioner","notifier","$timeout",function(a,b,c,d,e,f){return{restrict:"A",scope:{},link:function(g,h){g.help=a,g.kC=b,g.gS=c,g.vers=d,g.notifier=e,g.visible={},g.toggle=function(a){g.visible[a]=!g.visible[a]},g.$watch("help.active",function(a){g.active=a,f(function(){a?h.slideDown():(h.slideUp(),g.visible={})})})},templateUrl:"templates/arethusa.core/help_panel.html"}}]),angular.module("arethusa.core").directive("helpPanelHeading",[function(){return{restrict:"A",scope:{toggler:"@",heading:"@"},link:function(a){a.toggle=function(){a.$parent.toggle(a.toggler)}},template:'        <p          class="text underline clickable"          translate="{{ heading }}"          ng-click="toggle()">        </p>      '}}]),angular.module("arethusa.core").directive("helpPanelItem",[function(){return{restrict:"A",scope:!0,transclude:!0,link:function(a,b,c){a.toggler=c.toggler,a.heading=c.heading,a.height=c.height},templateUrl:"templates/arethusa.core/help_panel_item.html"}}]),angular.module("arethusa.core").directive("helpTrigger",["generator","help","translator","keyCapture",function(a,b,c,d){return a.panelTrigger({service:b,trsl:c,trslKey:"help",template:'<i class="fa fa-question"/>',kC:d,mapping:{name:"help",key:"H"}})}]),angular.module("arethusa.core").directive("keyCapture",["keyCapture",function(a){return{restrict:"A",link:function(b,c){c.on("keydown",function(b){a.keydown(b)}),c.on("keyup",function(b){a.keyup(b)})}}}]),angular.module("arethusa.core").directive("keysToScreen",["$timeout","configurator","keyCapture",function(a,b,c){return{restrict:"A",scope:{},link:function(d){function e(a){this.str="PLUS"===a?"+":a,this.joiner="PLUS"===a}function f(a){d.actions=arethusaUtil.map(c.keyList[a]||[],function(a){return{str:a}});var b,f;return b=(a+"").replace(/-/g,"-PLUS-").split("-"),f=arethusaUtil.inject([],b,function(a,b){b.match(/^[A-Z]$/)?arethusaUtil.pushAll(a,["shift","PLUS",b.toLowerCase()]):a.push(b)}),arethusaUtil.map(f,function(a){return new e(a)})}var g=b.configurationFor("main");if(g.showKeys){d.keys=[],d.actions=[];var h,i,j;d.$on("keyCaptureLaunched",function(b,c){var e=f(c);d.$apply(function(){j?(d.keys=e,j=!1):arethusaUtil.pushAll(d.keys,e)}),i&&a.cancel(i),h&&a.cancel(h),i=a(function(){j=!0},1500),h=a(function(){d.keys=[],d.actions=[]},3200)})}},templateUrl:"templates/arethusa.core/keys_to_screen.html"}}]),angular.module("arethusa.core").directive("langSpecific",["languageSettings",function(a){return{restrict:"A",link:function(b,c){var d=a.getFor("treebank")||a.getFor("hebrewMorph");d&&(c.attr("lang",d.lang),c.attr("dir",d.leftToRight?"ltr":"rtl"),c.css("font-family",d.font))}}}]),angular.module("arethusa.core").directive("layoutSetting",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b){b.gS=a,b.setting=a.settings.layout},templateUrl:"templates/arethusa.core/layout_setting.html"}}]),angular.module("arethusa.core").directive("navbarButtons",["translator",function(a){return{restrict:"A",replace:!0,link:function(b){b.$watch("windowWidth",function(a){var c=a>1090?"":"_collapsed";b.bTemplate="templates/arethusa.core/navbar_buttons"+c+".html"}),b.translations={},a("menu",b.translations,"menu")},template:'<ul class="has-form button-group right" ng-include="bTemplate"/>'}}]),angular.module("arethusa.core").directive("navbarNavigation",function(){return{restrict:"A",replace:!0,controller:"NavigatorCtrl",templateUrl:"templates/arethusa.core/navbar_navigation.html"}}),angular.module("arethusa.core").directive("navbarNotifier",function(){return{restrict:"A",replace:!0,templateUrl:"templates/arethusa.core/navbar_notifier.html"}}),angular.module("arethusa.core").directive("navbarSearch",function(){return{restrict:"A",replace:!0,controller:"SearchCtrl",templateUrl:"templates/arethusa.core/navbar_search.html"}}),angular.module("arethusa.core").directive("nextToken",["state",function(a){return{restrict:"AE",link:function(b,c){c.bind("click",function(){b.$apply(a.selectNextToken())})}}}]),angular.module("arethusa.core").directive("notifications",["notifier",function(){return{restrict:"A",scope:{},link:function(){},templateUrl:"templates/arethusa.core/notifications.html"}}]),angular.module("arethusa.core").directive("outputter",["$modal","saver","translator",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e){d.saver=b,e.bind("click",function(){a.open({templateUrl:"templates/arethusa.core/outputter.html",windowClass:"full-modal",scope:d})}),c("saver.previewAndDownload",function(a){e.attr("title",a)})},template:'<i class="fa fa-download"/>'}}]),angular.module("arethusa.core").directive("outputterItem",[function(){return{restrict:"A",link:function(a,b){b.addClass("item");var c;a.data=function(){return c||(c=a.obj.output()),c},a.togglePreview=function(){a.preview=!a.preview};var d;a.download=function(){d||(d=document.createElement("a"));var b=encodeURIComponent(a.data()),c="data:"+a.obj.mimeType+" ;charset=utf-8,",e=a.obj.identifier+"."+a.obj.fileType;d.setAttribute("href",c+b),d.setAttribute("download",e),d.click()}},templateUrl:"templates/arethusa.core/outputter_item.html"}}]),angular.module("arethusa.core").directive("plugin",["plugins",function(a){return{restrict:"AE",scope:!0,link:function(b,c,d){var e={aT:"artificialToken",SG:"sg"};b.name=e[d.name]||d.name,b.plugin=a.get(b.name),b.withSettings=d.withSettings,b.$on("pluginAdded",function(a,c,d){c===b.name&&(b.plugin=d)})},templateUrl:"templates/arethusa.core/plugin.html"}}]),angular.module("arethusa.core").directive("pluginSetting",["userPreferences",function(a){return{restrict:"A",scope:!0,link:function(b){b.change=function(){var c=b.setting.model,d=b.plugin[c],e=b.plugin[b.setting.change];a.set(b.plugin.name,c,d),e&&e()}},templateUrl:"templates/arethusa.core/plugin_setting.html"}}]),angular.module("arethusa.core").directive("pluginSettings",[function(){return{restrict:"A",templateUrl:"templates/arethusa.core/plugin_settings.html"}}]),angular.module("arethusa.core").directive("prevToken",["state",function(a){return{restrict:"AE",link:function(b,c){c.bind("click",function(){b.$apply(a.selectPrevToken())})}}}]),angular.module("arethusa.core").directive("resizable",["$window","$document",function(a,b){return{restrict:"AEC",link:function(c,d){function e(a){var b=Math.floor(a.pageX),c=Math.round(j.position().left),d=Math.round(j.width()),e=b-c,g=d-e,i=h.width()+e;f(g,i)&&(j.width(g),h.width(i))}function f(a,b){return a>k&&b>l}function g(){i.trigger("resize"),b.unbind("mousemove",e),b.unbind("mouseup",g)}var h=angular.element(document.getElementById("main-body")),i=angular.element(a),j=d.parent(),k=260,l=260;d.on("mousedown",function(a){a.preventDefault(),b.on("mousemove",e),b.on("mouseup",g)})}}}]),angular.module("arethusa.core").directive("revealToggle",function(){return{restrict:"A",link:function(a,b,c){function d(){return angular.element(document.getElementById(e))}var e=c.revealToggle,f=c.alwaysReveal,g=c.slide;b.bind("click",function(){var a=d();f||a.hasClass("hide")?(g&&a.slideDown(),a.removeClass("hide"),a.trigger("show-"+e)):(g&&a.slideUp(),a.addClass("hide"),a.trigger("hide-"+e))
})}}}),angular.module("arethusa.core").directive("rootToken",["state","globalSettings","depTree",function(a,b,c){return{restrict:"A",scope:{id:"@rootId",sentenceId:"@"},link:function(a,d){function e(b){a.$apply(b())}function f(){return b.clickActions[i][1]}function g(c,e){b.clickAction===i&&f()[c](a.id,d,e)}function h(){this.id=a.id,this.sentenceId=a.sentenceId}var i="change head";d.bind("click",function(){b.clickAction===i&&e(function(){c.changeHead(new h)})}),d.bind("mouseenter",function(a){e(function(){d.addClass("hovered"),g("mouseenter",a)})}),d.bind("mouseleave",function(a){e(function(){d.removeClass("hovered"),g("mouseleave",a)})})}}}]),angular.module("arethusa.core").directive("saver",["saver","translator",function(a,b){return{restrict:"A",scope:{},link:function(c,d){function e(){f(),h=c.$watch("saver.needsSave",function(a){a?(d.addClass("alert"),d.removeClass("disabled")):(d.addClass("disabled"),d.removeClass("alert"))})}function f(){h&&h()}function g(){d.attr("title",i+" "+j)}c.saver=a;var h;d.bind("click",function(){c.$apply(a.save())}),c.$watch("saver.canSave",function(a){a?(d.show(),e()):(d.hide(),f())});var i,j;c.$on("keysAdded",function(a,b){var c=b.saver;c&&(j=aU.formatKeyHint(c.save),g())}),b("save",function(a){i=a,g()})},template:'<i class="fi-save"/>'}}]),angular.module("arethusa.core").directive("sentence",["navigator",function(a){return{restrict:"A",scope:{sentence:"="},link:function(b){function c(){a.getCitation(b.sentence,function(a){b.citation=a})}b.goTo=function(b){a.goTo(b),a.switchView()},b.sentenceString=b.sentence.toString(),b.id=b.sentence.id,c()},templateUrl:"templates/arethusa.core/sentence.html"}}]),angular.module("arethusa.core").directive("sentenceList",["$compile","navigator",function(a,b){return{restrict:"A",scope:!0,link:function(c,d){function e(){if(!b.hasList){var d='              <div class="canvas-border"/>              <div id="canvas" class="row panel full-height scrollable" full-height>                <ul class="sentence-list">                  <li                     class="sentence-list"                    sentence="s"                    ng-repeat="s in n.sentences">                  </li>                </ul>              </div>            ';b.list().append(a(d)(c)),b.hasList=!0}}c.n=b,c.$on("viewModeSwitched",e),d.bind("click",function(){e(),c.$apply(function(){b.switchView()})})}}}]),angular.module("arethusa.core").directive("settingsTrigger",["translator",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){var e=d.settingsTrigger||"left",f="margin-"+("left"===e?"right":"left"),g="left"===e?"":"bw-";c.addClass(e),c.addClass("rotate-"+g+"on-hover"),c.css(f,"10px"),a("settings",function(a){c.attr("title",a)})},templateUrl:"templates/arethusa.core/settings_trigger.html"}}]),angular.module("arethusa.core").directive("sidepanel",["sidepanel","keyCapture","plugins",function(a,b,c){return{restrict:"A",link:function(){function d(){return c.sub.indexOf(c.active)}function e(){return c.sub.length-1}function f(a){var b=c.sub[a];c.setActive(b)}function g(){var a=d(),b=a===e()?i:a+1;f(b)}function h(){var a=d(),b=a===i?e():a-1;f(b)}var i=0,j=b.initCaptures(function(b){return{sidepanel:[b.create("nextTab",function(){b.doRepeated(g)},"W"),b.create("prevTab",function(){b.doRepeated(h)},"E"),b.create("toggle",function(){a.toggle()},"q")]}});angular.extend(a.activeKeys,j.sidepanel)}}}]),angular.module("arethusa.core").directive("sidepanelFolder",["sidepanel","$window","translator",function(a,b,c){return{scope:{},link:function(d,e){function f(){var b=a.folded?"expand":"compress",c=a.folded?"show":"fold",f=arethusaUtil.formatKeyHint(a.activeKeys.toggle);d.iconClass="fi-arrows-"+b,e.attr("title",d.translations[c]+" "+f)}var g=angular.element(b);d.translations={},c("sidepanel.show",d.translations,"show"),c("sidepanel.fold",d.translations,"fold"),d.$watch("translations",function(a,b){a!==b&&f()},!0),e.on("click",function(){a.toggle(),d.$apply(f())}),d.sp=a;var h=function(){};d.$watch("sp.active",function(a){a?(e.show(),h=d.$watch("sp.folded",function(){f(),g.trigger("resize")})):(e.hide(),h())})},template:'<i ng-class="iconClass"/>'}}]),angular.module("arethusa.core").directive("spinner",["spinner",function(a){return{restrict:"A",link:function(b){b.spinner=a,b.$watch("spinner.spinning",function(a){b.visible=a})},template:'<i ng-show="visible" class="fa fa-spinner fa-spin info-message"></i>'}}]),angular.module("arethusa.core").directive("toBottom",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){return d.parents(".gridster-item")}function f(){b(function(){var a=d.offset().top,b=g.offset().top+g.height();d.height(b-a);var c=d.find("svg");if(c[0]){var e=d[0].getBoundingClientRect().bottom,f=c.offset().top;c.height(e-f)}})}var g,h;if(aU.isArethusaMainApplication()){var i=e();i[0]?g=h=i:(g=angular.element(document.getElementById("canvas")),h=angular.element(a))}else g=h=d.parents('[ng-controller="ArethusaCtrl"]');angular.element(a).on("resize",f),c.$on("stateLoaded",f),f()}}}]),angular.module("arethusa.core").directive("token",["state","globalSettings",function(a,b){return{restrict:"AE",scope:{token:"=",colorize:"=",click:"@",hover:"@",highlight:"@"},link:function(c,d){function e(a){c.$apply(a())}function f(){d.bind("click",function(c){e(function(){var d=c.ctrlKey?"ctrl-click":"click";"click"===d&&a.hasClickSelections()?b.clickFn(m):a.toggleSelection(m,d)})})}function g(){d.bind("mouseenter",function(){e(function(){a.selectToken(m,"hover")})}),d.bind("mouseleave",function(){e(function(){a.deselectToken(m,"hover")})})}function h(){var a=b.preClickFn;a&&angular.forEach(a,function(a,b){d.bind(b,function(b){e(function(){a(m,d,b)})})})}function i(){c.click&&(f(),d.addClass("clickable"),h()),c.hover&&g()}function j(){d.removeClass("clickable"),d.unbind()}function k(){j(),i()}function l(){angular.forEach(c.token.style,function(a,b){d.css(b,"")})}if(c.token){angular.isObject(c.token)||(c.token=a.getToken(c.token)),c.state=a;var m=c.token.id;c.selectionClass=function(){return a.isSelected(m)?"hover"==a.selectionType(m)?"hovered":"selected":void 0},c.$on("clickActionChange",k),c.$watch("colorize",function(a){a?d.css(angular.isObject(a)?a:c.token.style||{}):l()}),c.$watch("token.style",function(a,b){a!==b&&(a?(d.removeAttr("style"),d.css(a)):l())},!0),c.token.artificial&&d.addClass(c.token.type),d.addClass("token"),i()}},templateUrl:"templates/token.html"}}]),angular.module("arethusa.core").directive("tokenWithId",["idHandler",function(a){return{restrict:"A",scope:{value:"=",tokenId:"="},link:function(b){function c(c){b.formatted=a.formatId(c,"%s-%w")}b.$watch("tokenId",c)},template:'<span>{{ value }} <sup class="note">{{ formatted }}</sup>'}}]),angular.module("arethusa.core").directive("translateLanguage",["$translate","translator","LOCALES",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e){function f(b){h=b||a.use()||"en",a.use(h),d.lang=h}function g(){var a;a=c.indexOf(h)+1,a=a>c.length-1?0:a,f(c[a])}var h;e.bind("click",function(){d.$apply(g)});var i=e.parent();b("language",function(a){i.attr("title",a)}),f()},templateUrl:"templates/arethusa.core/translate_language.html"}}]),angular.module("arethusa.core").directive("unusedTokenHighlighter",["state","$parse","$window","translator","StateChangeWatcher",function(a,b,c,d,e){return{restrict:"A",scope:{highlightMode:"@unusedTokenHighlighter",style:"=unusedTokenStyle",uthCheckProperty:"@"},link:function(f,g){function h(){p.applyToMatching(function(b){a.addStyle(b,l)})}function i(b){var c=Object.keys(l);a.removeStyle(b,c)}function j(){p.applyToMatching(function(a){i(a)})}function k(){j(),a.multiSelect(Object.keys(p.matchingTokens))}var l=f.style||{"background-color":"rgb(255, 216, 216)"},m=!!f.highlightMode;f.s=a,f.total=a.totalTokens;var n=b(f.uthCheckProperty),o={newMatch:function(b){m&&a.addStyle(b.id,l)},lostMatch:function(a){m&&i(a.id)},changedCount:function(a){f.unusedCount=a}},p=new e(f.uthCheckProperty,n,o);p.initCount(),m&&h(),g.bind("click",function(){f.$apply(function(){m?j():h()}),m=!m}),g.bind("dblclick",function(a){return f.$apply(function(){k()}),a.preventDefault(),c.getSelection().empty(),!1}),f.$watch("s.tokens",function(){p.initCount()}),f.$on("tokenAdded",function(){f.total++,p.initCount(),m&&h()}),f.$on("tokenRemoved",function(){f.total--}),f.tooltip={},d("uth.tooltip",f.tooltip,"text")},template:'      <span      tooltip-html-unsafe="{{ tooltip.text }}"      tooltip-popup-delay="700"      tooltip-placement="left"      translate="uth.count"      translate-value-count="{{ unusedCount }}"      translate-value-total="{{ total }}">      '}}]),angular.module("arethusa.core").directive("uservoiceTrigger",["translator",function(a){return{restrict:"A",compile:function(b){return b.attr("id","uservoicebutton"),b.attr("data-uv-trigger","contact"),function(b,c){var d=c.parent();a("contactUs",function(a){d.attr("title",a)})}},template:'<i class="fi-comment"/>'}}]),angular.module("arethusa.core").directive("valueWatch",function(){return{restrict:"A",scope:{target:"=",property:"@",emptyVal:"@"},link:function(a,b){a.$watch("target."+a.property,function(c){c?(a.value=c,b.removeClass("bold")):(a.value=a.emptyVal||"",b.addClass("bold"))})},template:"<span>{{ value }}</span>"}}),angular.module("arethusa.core").service("documentStore",function(){function a(a){angular.extend(b.confs,a.conf)}var b=this;this.reset=function(){this.store={},this.confs={}},this.addDocument=function(c,d){b.store[c]=d,a(d)},this.hasAdditionalConfs=function(){return!angular.equals(b.confs,{})},this.reset()}),angular.module("arethusa.core").value("duScrollEasing",function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1}),angular.module("arethusa.core").service("editors",["User",function(a){var b=this;this.perDocument={},this.addEditor=function(c,d){var e=b.perDocument[c];e||(e=b.perDocument[c]=[]),e.push(new a(d)),b.editorsPresent=!0},this.editorsPresent=!1}]),angular.module("arethusa.core").service("exitHandler",["$location","$window","configurator",function(a,b,c){function d(){return arethusaUtil.inject({},i,function(b,c){b[c]=a.search()[c]})}function e(a,b){if(!angular.equals({},b)){a+="?";var c=arethusaUtil.inject([],b,function(a,b,c){a.push(b+"="+c)});a+=c.join("&")}return a}function f(){var a=d(),b=h,c=arethusaUtil.inject({},a,function(a,c,d){b.indexOf(":"+c)>-1?b=b.replace(":"+c,d):a[c]=d});return e(b,c)}var g=c.configurationFor("exitHandler")||{};this.defined=!angular.equals({},g),this.title=g.title;var h=g.route,i=g.params;this.leave=function(a){a=a||"_self",b.open(f(),a)}}]),angular.module("arethusa.core").filter("keys",function(){return function(a){return a?Object.keys(a):[]}}),angular.module("arethusa.core").service("globalSettings",["configurator","plugins","$injector","$rootScope","notifier","translator","keyCapture","$timeout",function(a,b,c,d,e,f,g,h){function i(){q.conf=a.configurationFor("main").globalSettings||{},a.delegateConf(q,s,!0),k()}function j(a,b,c,d){this.property=a,this.label=d||"globalSettings."+a,this.type=b||"checkbox",this.directive=c}function k(){q.defineSetting("persistSettings"),q.defineSetting("chunkMode","custom","chunk-mode-switcher"),q.defineSetting("clickAction","custom","global-click-action"),q.defineSetting("alwaysDeselect"),q.defineSetting("disableKeyboardMappings"),q.defineSetting("colorizer","custom","colorizer-setting"),q.defineSetting("layout","custom","layout-setting")}function l(){return u||(u=c.get("state")),u}function m(){return v||(v=c.get("userPreferences")),v}function n(){q.layouts=a.configurationFor("main").layouts,q.layout=q.layouts[0],q.broadcastLayoutChange()}function o(){return[r.layoutLoaded.start,q.layout.name,r.layoutLoaded.end].join(" ")}function p(){if(!(q.layouts.length<2)){var a=q.layouts.indexOf(q.layout)+1;a==q.layouts.length&&(a=0),q.layout=q.layouts[a],q.broadcastLayoutChange()}}var q=this;q.name="globalSettings",q.layout={},q.settings={},q.colorizers={disabled:!0};var r={};f("globalSettings.layoutLoaded",r,"layoutLoaded",!0);var s=["alwaysDeselect","colorizer","persistSettings","disableKeyboardMappings"];q.defaultConf={alwaysDeselect:!1,colorizer:"morph",persistSettings:!0,disableKeyboardMappings:!1},this.defineSetting=function(a,b,c,d){q.settings[a]=new j(a,b,c,d)},this.removeSetting=function(a){delete q.settings[a]},this.propagateSetting=function(a){m().set(q.name,a,q[a])},this.toggle=function(){q.active=!q.active};var t={};this.deselectAfterAction=function(a){t[a]=!0},this.noDeselectAfterAction=function(a){t[a]=!1},this.shouldDeselect=function(a){return q.alwaysDeselect||t[a]},this.defaultClickAction=function(a){l().toggleSelection(a,"click")},this.clickActions={},this.addClickAction=function(a,b,c){q.clickActions[a]=[b,c]},this.removeClickAction=function(a){delete q.clickActions[a],q.clickAction===a&&q.setClickAction("disabled")},this.setClickAction=function(a,b){if(q.clickAction!==a){q.clickAction=a;var c=q.clickActions[q.clickAction];q.clickFn=c[0],q.preClickFn=c[1],b||d.$broadcast("clickActionChange")}},this.addColorizer=function(a){q.colorizers[a]=!0},this.isColorizer=function(a){return q.colorizer===a};var u,v;this.applyColorizer=function(){"disabled"===q.colorizer?l().unapplyStylings():q.colorizers[q.colorizer]&&b.get(q.colorizer).applyStyling()},this.colorMaps=function(){return arethusaUtil.inject({},q.colorizers,function(a,c){"disabled"!==c&&(a[c]=b.get(c).colorMap())})},d.$on("confLoaded",n),this.broadcastLayoutChange=function(){q.layout.grid&&h(function(){e.warning("The grid layout is an experimental feature and WILL contain bugs!","WARNING")},1200),h(function(){e.info(o())},500),d.$broadcast("layoutChange",q.layout)},g.initCaptures(function(a){return{layout:[a.create("cycle",p,"l")]}}),this.init=function(){i(),q.addClickAction("disabled",q.defaultClickAction),q.setClickAction("disabled",!0)}}]),angular.module("arethusa.core").factory("globalStore",[function(){return{}}]),angular.module("arethusa.core").service("help",[function(){var a=this;this.toggle=function(){a.active=!a.active},a.active=!1}]),angular.module("arethusa.core").service("idHandler",[function(){function a(a){return/(\d*)(\w*)?/.exec(a)}function b(a,b){this.internalId=a,this.sourceId=b}function c(){var a=this;this.mapped={},this.unmapped=[],this.fullMap={},this.add=function(b,c,d){var e=b.idMap.sourceId(c),f=b.id;e?a.mapped[e]=b:(a.unmapped.push(b),e=d(),b.idMap.add(c,f,e)),a.fullMap[f]=e}}function d(a){var b=i.indexOf(a)-1;return i[b]}function e(a){var b=i.indexOf(a)+1;return i[b]}function f(b,c){var f=g(b),i=f.pop(),j=f.pop(),k=a(i),l=k[1],m=k[2]||"";return m?m=c?e(m):d(m):c?l++:l--,h.getId(l,j)+m}function g(a){return a.split("-")}var h=this;this.getId=function(a,b){var c=b?arethusaUtil.formatNumber(b,4):"",d=arethusaUtil.formatNumber(a,4);return c?c+"-"+d:d},this.padIdWithSId=function(a,b){var c=aU.formatNumber(b,4);return c+"-"+a},this.formatId=function(b,c){if(b){c=c?c:"%w";var d,e=g(b),f=e.pop(),h=a(f),i=arethusaUtil.formatNumber(h[1]),j=arethusaUtil.formatNumber(e.pop(),0);return d=c.replace("%w",i+(h[2]||"")),c.indexOf(!1)&&(d=j?d.replace("%s",j):d.replace("%s-","")),d}},this.Map=function(){var a=this;this.mappings={},this.add=function(c,d,e){a.mappings[c]=new b(d,e)},this.sourceId=function(b){var c=a.mappings[b];return c?c.sourceId:void 0}},this.sourceIdMap=function(a,b){return arethusaUtil.inject({},a,function(a,c,d){a[d.idMap.sourceId(b)]=c})},this.transformToSoureIds=function(a,b,d){new c;return arethusaUtil.inject(new c,a,function(a,c,e){a.add(e,b,d)})};for(var i=[],j=97;123>j;j++)i.push(String.fromCharCode(j));this.isExtendedId=function(a){return a.match(/.*[a-z]$/)};var k="e";this.extendId=function(a){return a+k},this.stripExtension=function(a){return h.isExtendedId(a)?a.slice(0,-1):a},this.decrement=function(a){return f(a,!1)},this.increment=function(a){return f(a,!0)},this.nonSequentialIds=function(a){var b={};return angular.forEach(a,function(c,d){var e=a[d+1];e&&h.decrement(e)!==c&&(b[d]=!0)}),b}}]),angular.module("arethusa.core").service("keyCapture",["configurator","$rootScope",function(a,b){function c(a){var b=a.split("-"),c=b.pop();return c.match(/[A-Z]/)&&(arethusaUtil.isIncluded(b,"shift")||b.push("shift"),c=c.toLowerCase()),[b,w[c]]}function d(a){return Object.keys(a.modifiers)}function e(a,b){var c=a.length-1,d=a[c],e=a.slice(0,c);return e.sort(function(a,c){return b[a]-b[c]}),e.concat(d)}function f(a){var b=(v.conf("keys")||{})[a];return b||{}}function g(a){var b=a.keyCode;return a.shiftKey&&(b+=v.shiftModifier),a.ctrlKey&&(b+=v.ctrlModifier),a.altKey&&(b+=v.altModifier),a.metaKey&&(b+=v.metaModifier),b}function h(a){b.$broadcast("keyCaptureLaunched",E[a]||a)}function i(a){if(!isNaN(a)){var b=parseInt(a)-48;return b>-1&&10>b}}function j(){D=""}function k(a,b){this.callback=a,this.priority=b||0}function l(a,b){E[a]=b}function m(a){return a.sort(function(a,b){return b.priority-a.priority})}function n(){F=!1}function o(a,b){angular.forEach(a,function(a){F||a.callback(b)})}function p(a,b,c){this.confKey=a,this.fn=b,this.defaultKey=c}function q(a,b,c,d){a[b]||(a[b]={}),a[b][c]=d}function r(a){angular.extend(v.activeKeys,a),angular.forEach(a,function(a,b){angular.forEach(a,function(a,c){var d=v.keyList[a];d||(d=v.keyList[a]=[]),d.push(b+"."+c)})})}function s(){var a=v.conf("keys");return a.us}function t(a,b){var c=a.style,d={lower:"0",upper:"1"};c.class=c.class||{},void 0===a.hide&&(c.class[d[b]]="inactive")}function u(a,b,c){var d=b.show,e=b[c];e&&(a[e]?d.push(a[e]):(t(b,c),d.push(e)))}var v=this;this.conf=function(b){var c=a.configurationFor("keyCapture")||{};return c[b]||{}};for(var w={"return":13,shift:16,ctrl:17,alt:18,esc:27,up:38,down:40,"↑":38,"↓":40,":":186,"[":219,"'":222,"]":221},x=97;123>x;x++)w[String.fromCharCode(x)]=x-32;var y=arethusaUtil.inject({},w,function(a,b,c){a[c]=b});this.codeToKey=function(a){return y[a]},this.keyToCode=function(a){return w[a]},this.shiftModifier=1e3,this.ctrlModifier=2e3,this.altModifier=4e3,this.metaModifier=8e3,this.getKeyCode=function(a){var b=c(a),d=b[0],e=b[1];return angular.forEach(d,function(a){var b;switch(a){case"ctrl":b=v.ctrlModifier;break;case"shift":b=v.shiftModifier;break;case"alt":b=v.altModifier;break;case"meta":b=v.metaModifier}e+=b}),e};var z=[];this.getForeignKey=function(a,b){if(a.altKey||a.ctrlKey)return void 0;var c=[],g=f(b),h=y[a.keyCode],i=g.modifiers;if(h){if("shift"==h)return;if(a.shiftKey&&c.push("shift"),arethusaUtil.isIncluded(d(g),h)){c.push(h);var j=c.join("-");return z.push(j),!1}if(arethusaUtil.isIncluded(c,"shift")){var k=c.indexOf("shift");c.splice(k,1),h=h.toUpperCase()}c.push(h)}var l=z.concat(c),m=e(l,i),n=g[m.join("-")];return z=[],n};var A={},B=function(a){var b=g(a),c=A[b];c&&(o(c,a),n())},C=["INPUT","TEXTAREA"];this.keydown=function(a){if(!arethusaUtil.isIncluded(C,a.target.tagName)&&!i(a.keyCode)){var b=g(a);A[b]&&h(b)}};var D="";this.keyup=function(a){if(!arethusaUtil.isIncluded(C,a.target.tagName)){if(i(a.keyCode)){var b=a.keyCode-48;return h(b),void(D+=b)}B(a),j()}},this.doRepeated=function(a){for(var b=parseInt(D,10)||1;b>0;b--)a()};var E={};this.onKeyPressed=function(a,b,c){var d=v.getKeyCode(a);l(d,a);var e=A[d]||[];e.push(new k(b,c)),A[d]=m(e)};var F=!1;this.stopPropagation=function(){F=!0},this.registerCaptures=function(a,c){c=c?c:b,angular.forEach(a,function(a,b){angular.isDefined(b)&&v.onKeyPressed(b,function(){c.$apply(a)})})},this.create=function(a,b,c){return new p(a,b,c)},this.initCaptures=function(a){var c=arethusaUtil.inject({},a(v),function(a,c,d){var e=v.conf(c);angular.forEach(d,function(d){var f=e[d.confKey]||d.defaultKey;angular.isDefined(f)&&(q(a,c,d.confKey,f),v.onKeyPressed(f,function(){b.$apply(d.fn)}))})});return angular.equals({},c)||(b.$broadcast("keysAdded",c),r(c)),c},this.mappedKeyboard=function(a,b){var c=f(a),d=s(),e=[],g=["lower","upper"];return g=b?g.reverse():g,angular.forEach(d,function(a){a.show=[],angular.forEach(g,function(b){u(c,a,b)}),e.push(a)}),e},this.activeKeys={},this.keyList={}}]),angular.module("arethusa.core").controller("LandingCtrl",["$scope","$window","translator",function(a,b,c){function d(a,b,d,e){c(a,this,"name"),this.name=a,this.caption=b,this.img=g+d,this.url="#/"+e}function e(a,b){this.name=a,this.examples=b}function f(a,b,c){this.name=a,this.img=g+b,this.href=c}a.template="templates/landing_page.html";var g="../dist/examples/images/";a.useCases=[new e("Treebanking",[new d("depTrees","","create1.png","example_tb_create?doc=athenaeus12"),new d("review","","tb_review.png","example_tb_review?doc=11&gold=1"),new d("landing.tryYourself","","create2.png","example_tb_create?doc=clean")])],a.partners=[new f("DH Leipzig","dh_logo.png","http://www.dh.uni-leipzig.de"),new f("Perseids","perseids_logo.png","http://sites.tufts.edu/perseids"),new f("Alpheios","alpheios_logo.png","http://www.alpheios.net"),new f("Perseus","perseus_logo.jpg","http://www.perseus.tufts.edu")],a.goTo=function(a){b.open(a)}}]),angular.module("arethusa.core").service("languageSettings",["documentStore",function(a){var b=this;this.languageSpecifics={ara:{name:"Arabic",lang:"ar",leftToRight:!1,font:"Amiri"},grc:{name:"Greek",lang:"gr",leftToRight:!0},heb:{name:"Hebrew",lang:"he",leftToRight:!1}},this.langNames=arethusaUtil.inject({},b.languageSpecifics,function(a,b,c){a[c.lang]=c.name});var c={};this.setFor=function(a,d){c[a]=b.languageSpecifics[d]},this.getFor=function(d){var e=c[d];if(e)return e;var f=a.store[d];if(void 0===f)return void 0;var g=f.json.treebank||f.json.book;if(g){var h=g["_xml:lang"];if(h in b.languageSpecifics){var i=b.languageSpecifics[h];return b.setFor("treebank",i),i}}return void 0}}]),angular.module("arethusa.core").constant("LOCALES",["en","de","fr"]),angular.module("arethusa.core").service("locator",["$location",function(a){var b,c={};this.get=function(d){return b?c[d]:a.search()[d]},this.watchUrl=function(a){b=!a},this.set=function(a,b){b?c[a]=b:angular.extend(c,a)}}]),angular.module("arethusa.core").service("navigator",["$injector","configurator","$cacheFactory","keyCapture","$rootScope","globalSettings",function(a,b,c,d,e,f){function g(){var a=f.layout.navigator||{};return a.chunkSize}function h(){return g()||w.conf.chunkSize||1}function i(a){w.currentPosition=a}function j(){w.currentSentences=void 0,x=void 0,w.currentChunk()}function k(a){for(var b,c=w.sentences.length-1;c>=0;c--)if(w.sentences[c].id===a){b=w.sentences[c];break}return b}function l(){p(),w.getCitation(z(),q)}function m(a){return a.match(/^urn:cts/)}function n(a,b){var c,d=o(a),e=d[0],f=d[1];c=A.get(e),c?b(r(c,f)):v.get({cite:e}).then(function(a){c=a.data,A.put(e,c),b(r(c,f))})}function o(a){var b=a.lastIndexOf(":");return[a.slice(0,b),a.slice(b+1)]}function p(){delete w.status.citation}function q(a){w.status.citation=a}function r(a,b){return[a.author,a.work,b].join(" ")}function s(a){var b=w.currentPosition+a*w.chunkSize;0>b&&(b=0),w.currentPosition=b,w.updateState()}function t(){w.status.hasNext=w.hasNext(),w.status.hasPrev=w.hasPrev()}function u(){w.hasList=!1}var v,w=this;this.init=function(){w.conf=b.configurationFor("navigator"),w.chunkModes=["sentence"],w.chunkMode=w.conf.chunkMode||"sentence",w.chunkSize=h(),w.sentences=[],w.sentencesById={},w.status={},i(0),v=b.provideResource("citeMapper"),d.initCaptures(function(a){return{navigation:[a.create("nextChunk",function(){a.doRepeated(w.nextChunk)},"u"),a.create("prevChunk",function(){a.doRepeated(w.prevChunk)},"i"),a.create("list",function(){w.switchView()},"L")]}}),navigator.chunkMode="sentence",e.$on("layoutChange",function(){w.changeChunkSize(h())})},this.applyChunkMode=function(){},this.changeChunkSize=function(a){w.chunkSize!==a&&(w.chunkSize=a,w.updateState())},this.state=function(){return w.lazyState||(w.lazyState=a.get("state")),w.lazyState},this.addSentences=function(a){arethusaUtil.pushAll(w.sentences,a),angular.forEach(a,function(a){w.sentencesById[a.id]=a}),j()};var x,y=function(){return arethusaUtil.map(z(),"id")},z=function(){var a=w.currentPosition;return w.currentSentences||(w.currentSentences=w.sentences.slice(a,a+w.chunkSize)||[]),w.currentSentences};this.currentChunk=function(){if(!x){x={};for(var a=z(),b=0;b<a.length;b++)angular.extend(x,a[b].tokens)}return x},this.nextChunk=function(){w.hasNext()&&s(1)},this.prevChunk=function(){w.hasPrev()&&s(-1)},this.hasNext=function(){return w.currentPosition+w.chunkSize<w.sentences.length},this.hasPrev=function(){return w.currentPosition>0},this.goToFirst=function(){i(0),w.updateState()},this.goTo=function(a){var b=k(a);if(b){var c=w.sentences.indexOf(b);return i(c),w.updateState(),!0}alert("No sentence with id "+a+" found")},this.goToByPosition=function(a){w.sentences.length>a&&(i(a),w.updateState())},this.goToLast=function(){i(w.sentences.length-w.chunkSize),w.updateState()};var A=c("citation",{number:100});this.getCitation=function(a,b){if(v){var c=a[0];if(c){var d=c.cite;d&&(m(d)?n(d,b):b(d))}}},this.updateState=function(){w.updateId(),w.state().replaceState(w.currentChunk())},this.updateId=function(){t(),j(),w.status.currentPos=w.currentPosition,w.status.currentIds=y(),l()},this.sentenceToString=function(a){return arethusaUtil.inject([],a.tokens,function(a,b,c){a.push(c.string)}).join(" ")},this.editor=function(){return angular.element(document.getElementById("arethusa-editor"))},this.list=function(){return angular.element(document.getElementById("arethusa-sentence-list"))},this.switchView=function(){e.$broadcast("viewModeSwitched");var a=w.editor(),b=w.list();w.listMode?(a.removeClass("hide"),b.addClass("hide"),w.listMode=!1):(a.addClass("hide"),b.removeClass("hide"),w.listMode=!0)},this.reset=function(){i(0),w.sentences=[],w.sentencesById={},w.listMode=!1,u(),w.updateId()},this.addToken=function(a){var b=a.sentenceId,c=a.id;w.sentencesById[b].tokens[c]=a},this.removeToken=function(a){var b=a.sentenceId,c=a.id;delete w.sentencesById[b].tokens[c]},this.markChunkChanged=function(){for(var a=z(),b=a.length-1;b>=0;b--)a[b].changed=!0},e.$on("tokenChange",w.markChunkChanged),e.$on("tokenAdded",w.markChunkChanged),e.$on("tokenRemoved",w.markChunkChanged),e.$on("layoutChange",u)}]),angular.module("arethusa.core").controller("NavigatorCtrl",["$scope","navigator","translator",function(a,b,c){function d(a){var b=[],c=[];return b.push(c),a&&angular.forEach(a,function(a){var d=aU.last(c);d&&parseInt(d)+1!==parseInt(a)?(c=[a],b.push(c)):c.push(a)}),arethusaUtil.map(b,function(a){if(a.length>1){var b=a[0],c=a[1];return b+"-"+c}return a[0]}).join(", ")}a.next=function(){b.nextChunk()},a.prev=function(){b.prevChunk()},a.goToFirst=function(){b.goToFirst()},a.goToLast=function(){b.goToLast()},a.goTo=function(a){b.goTo(a)},a.nav=b,a.$watch("nav.status",function(b){a.navStat=b}),a.$watchCollection("navStat.currentIds",function(b){b&&(a.ids=d(b))}),a.trsls={},c("navigator.goToNext",a.trsls,"goToNext"),c("navigator.goToPrev",a.trsls,"goToPrev"),c("navigator.goToFirst",a.trsls,"goToFirst"),c("navigator.goToLast",a.trsls,"goToLast")}]),angular.module("arethusa.core").service("notifier",["configurator","toaster","$timeout",function(a,b,c){function d(){k.conf=a.configurationFor("notifier"),k.disable=k.conf.disable,k.duration=k.conf.duration||1e4,k.maxMessages=k.conf.maxMessages||15}function e(a,b,c){this.type=a,this.message=b,this.title=c,this.time=new Date}function f(a){k[a]=function(b,c,d){k.disable||k.addMessage(a,b,c,d)}}function g(a,b,c){return[a,b,c].join("||")}function h(a){return l[a]}function i(a){return function(){c.cancel(l[a])}}function j(a,b){l[a]=c(i,b,!1)}var k=this;this.messages=[];var l={},m=["success","info","wait","warning","error"];angular.forEach(m,f),this.addMessage=function(a,c,d,f){k.messages.length===k.maxMessages&&k.messages.pop();var i=g(a,c,d);if(!h(i)){f&&j(i,f);var l=new e(a,c,d);k.messages.unshift(l),b.pop(a,d,c)}},this.toggle=function(){k.panelActive=!k.panelActive},this.init=function(){d()}}]),angular.module("arethusa.core").service("plugins",["configurator","$injector","$rootScope","$q","$timeout","dependencyLoader","notifier","translator",function(a,b,c,d,e,f,g,h){function i(){B.main=[],B.sub=[],B.withMenu=[],angular.forEach(B.all,B.registerPlugin)}function j(a){return!(!a.template||a.noView)}function k(a){return a.replace(/([A-Z])/g,"_$1").toLowerCase()}function l(a,b){function c(a,b){return b?a:"arethusa."+a}function d(a){return a||"dist/"+k(e.name)+".min.js"}var e=this;this.name=c(a,b),this.files=[d(b)]}function m(b){if("history"===b){var c=d.defer();return c.resolve(),c.promise}var e=a.configurationFor(b),g=new l(b,e.location);return f.load(g)}function n(a,b){o(a)&&b.resolve()}function o(a){return Object.keys(B.loader).length===a.length}function p(a){var b=d.defer();return a()["finally"](aU.resolveFn(b)),b.promise}function q(a){if(angular.isArray(a))return f.load(a);var b=a.ordered,c=a.unordered,e=[];return b&&e.push(p(function(){return f.loadInOrder(b)})),c&&e.push(p(function(){return f.load(c)})),d.all(e)}function r(a){var c=a.replace(/.*?\./,"");return b.get(c)}function s(a){var b=d.defer();return angular.forEach(a,function(c){var d,e,f=m(c);f.then(function(){e=r(c);var a=e.externalDependencies;a?d=q(a):B.loader[c]=r(c)},function(){B.loader[c]=!1}),f["finally"](function(){d?d["finally"](function(){B.loader[c]=r(c),n(a,b)}):n(a,b)})}),b.promise}function t(a){angular.forEach(a,function(a){var b=B.loader[a];b&&(B.all[a]=b)})}function u(a,b){e(function(){c.$broadcast("pluginAdded",b,a)})}function v(){angular.forEach(B.all,u)}function w(a){angular.isFunction(a.init)&&a.init()}function x(){B.setActive(B.sub[0])}function y(){var a=this,b=y;this.after={},this.before={},b.prototype.resolve=function(b,c){var d=a[b][c]||[];angular.forEach(d,function(a){a()})},b.prototype.add=function(b,c,d){var e=a[b],f=e[c];f||(f=e[c]=[]),f.push(d),z[c]&&d()}}var z,A,B=this,C={};h("plugins.added",C,"added",!0),h("plugins.failed",C,"failed",!0),h("plugins.alreadyLoaded",C,"alreadyLoaded",!0),this.registerPlugin=function(a){j(a)&&(a.main?B.main.push(a):B.sub.push(a)),a.contextMenu&&B.withMenu.push(a)},this.start=function(a){B.loaded=!1,B.loader={},B.all={};var b=d.defer();return s(a).then(function(){t(a),B.init(),i(),x(),v(),B.loader={},B.loaded=!0,c.$broadcast("pluginsLoaded"),b.resolve()}),b.promise},this.setActive=function(a){B.active=a},this.isActive=function(a){return B.isSelected(a)&&!a.alwaysActive},this.isSelected=function(a){return a===B.active},this.doAfter=function(a,b){A.add("after",a,b)},this.declareReady=function(a){var b="string"==typeof a?a:a.name;z[b]=!0,A.resolve("after",b)},this.addPlugin=function(c,e){if(B.all[c]){var f=C.alreadyLoaded;return void g.warning([f.start,c,f.end].join(" "))}e&&a.addPluginConf(c,e);var h,i=d.defer(),j=i.promise,k=m(c),l=function(){h=b.get(c);var a=h.externalDependencies;a?q(a).then(n,o):n()},n=function(){B.all[c]=h,B.registerPlugin(h),h.init(),u(h,c);var a=C.added;g.success([a.start,c,a.end].join(" ")),i.resolve(h)},o=function(){var a=C.failed,b=[a.start,c,a.end].join(" ");g.error(b.trim()+"!"),i.reject()};return k.then(l,o),j},this.get=function(a){return(B.all||{})[a]||{}},this.init=function(){z={},A=new y,angular.forEach(B.all,w)}}]),angular.module("arethusa.core").factory("Resource",["$resource","$q","locator","spinner",function(a,b,c){function d(a){return arethusaUtil.inject({},a,function(a,b){a[b]=c.get(b)})}function e(a){return a?a.match("json"):void 0}function f(a,b){return angular.extend(d(a),b)||{}}function g(a,b){var c={};return c.data=e(b()["content-type"])?JSON.parse(a):a,c.headers=b,c.source="tbd",c}function h(){return b.defer()}return function(c,d){function i(){return k=h(),a(j.route,null,{get:{method:"GET",withCredentials:d.withCredentials,transformResponse:g,timeout:k.promise},save:{method:"POST",withCredentials:d.withCredentials,transformRequest:function(a,b){var c=j.mimetype||"application/json";return b()["Content-Type"]=c,e(c)&&(a=angular.toJson(a)),j.auth.transformRequest(b),a},transformResponse:g}})}var j=this;this.route=c.route,this.params=c.params||[],this.auth=d,d.checkAuthentication();var k;this.resource=i(),this.get=function(a){var b=f(j.params,a),c=j.resource.get(b).$promise;
return c};this.save=function(a,c){var e=f(j.params,{});j.mimetype=c;var g=b.defer(),h=g.promise;return d.withAuthentication(g,function(){return j.resource.save(e,a).$promise}),h},this.post=this.save,this.abort=function(){k.resolve(),j.resource=i()}}}]),angular.module("arethusa.core").constant("LANDING",{controller:"LandingCtrl",template:'    <div style="height: 100%; overflow: auto">      <div        ng-include="template"         class="fade slow">      </div>    </div>  ',resolve:{scrollBody:function(){angular.element(document.body).css("overflow","auto")},conf:["configurator",function(a){a.defineConfiguration({navbar:{template:"templates/navbar_landing.html"}})}]}}),angular.module("arethusa.core").constant("MAIN_ROUTE",{controller:"ArethusaCtrl",template:'    <div>      <arethusa-navbar></arethusa-navbar>      <div        ng-include="gS.layout.template"         class="fade slow">      </div>    </div>  ',resolve:{loadConfiguration:["$http","confUrl","configurator",function(a,b,c){var d=b(!0);return a.get(d).then(function(a){c.defineConfiguration(a.data,d)})}]}}),angular.module("arethusa.core").service("saver",["configurator","notifier","keyCapture","state","$rootScope","$window","translator",function(a,b,c,d,e,f,g){function h(){var b=a.configurationFor("main").persisters;return a.getPersisters(b)}function i(){return aU.inject({},v,function(a,b,c){angular.isFunction(c.output)&&(a[b]=c)})}function j(){v=h(),w.outputters=i()}function k(){return!angular.equals({},v)}function l(){k()&&m()&&(w.canSave=!0)}function m(){return"editor"===a.mode()}function n(){w.canSave=!1}function o(){w.needsSave=!1,s(),b.success(x.success)}function p(a){406==a.status?o():b.error(x.error)}function q(a){a.saveData(o,p)}function r(){w.activeKeys={};var a=c.initCaptures(function(a){return{saver:[a.create("save",function(){w.save()},"ctrl-S")]}});angular.extend(w.activeKeys,a.saver)}function s(){y=d.watch("*",t),d.on("tokenAdded",t),d.on("tokenRemoved",t)}function t(){w.needsSave=!0,u()}function u(){y&&y(),y=void 0}var v,w=this,x={};g("saver.success",x,"success"),g("saver.error",x,"error"),g("saver.inProgress",x,"inProgress"),g("saver.nothingToSave",x,"nothingToSave"),g("saver.confirmNote",x,"confirmNote"),g("saver.confirmQuestion",x,"confirmQuestion"),this.save=function(){w.needsSave?(b.wait(x.inProgress),angular.forEach(v,q)):b.info(x.nothingToSave)};var y;d.debug||(f.onbeforeunload=function(){return w.needsSave?x.confirmNote:void 0},e.$on("$locationChangeStart",function(a){w.needsSave&&(f.confirm(x.confirmNote+"\n"+x.confirmQuestion)||a.preventDefault())}),e.$on("destroy",function(){f.onbeforeunload=void 0})),this.init=function(){r(),n(),j(),l(),s()}}]),angular.module("arethusa.core").controller("SearchCtrl",["$scope","$location","translator",function(a,b,c){a.search=function(){b.search("doc",a.query)},c("search_documents",function(b){a.search_documents=b})}]),angular.module("arethusa.core").service("sidepanel",["globalSettings","$rootScope","$timeout",function(a,b,c){function d(a){return angular.element(document.getElementById(a))}function e(){h.width(h.width()-i.width()),i.show()}function f(){h.width(h.width()+i.width()),i.hide()}function g(){var b=a.layout;j.active=b.sidepanel,j.active&&(j.folded=b.folded,c(function(){h=d("main-body"),i=d("sidepanel"),j.folded&&f()}))}var h,i,j=this;this.toggle=function(){i.width(i.width()),j.folded?e():f(),j.folded=!j.folded},this.activeKeys={},b.$on("layoutChange",g),g()}]),angular.module("arethusa.core").service("spinner",function(){var a=this;this.spinning=0,this.spin=function(){a.spinning++},this.stop=function(){a.spinning--}}),angular.module("arethusa.core").service("state",["configurator","navigator","$rootScope","documentStore","keyCapture","locator","StateChange","idHandler","globalSettings","logger",function(a,b,c,d,e,f,g,h,i,j){function k(){t.conf=a.configurationFor("main"),s=a.getRetrievers(t.conf.retrievers),t.silent=!0,t.batchChange=!1,t.debug=t.conf.debug,t.initServices(),t.activeKeys={};var b=e.initCaptures(function(a){return{selections:[a.create("nextToken",function(){a.doRepeated(t.selectNextToken)},"w"),a.create("prevToken",function(){a.doRepeated(t.selectPrevToken)},"e"),a.create("deselect",function(){t.deselectAll()},"esc")]}});angular.extend(t.activeKeys,b.selections)}function l(){return 0===Object.keys(s).length}function m(){var a=t.conf.chunkParam;return a?f.get(a):void 0}function n(){var a=m();a&&b.goTo(a)||b.updateId()}function o(a){var b=m();if(b){var c=arethusaUtil.map(a,function(a){return h.padIdWithSId(a,b)});p(c)}}function p(a){angular.forEach(a,function(a){t.selectToken(a,"ctrl-click")})}function q(a){a.status||(a.status={})}function r(a,b,c,d){var e=this;this.event=a,this.exec=b,this.destroy=function(){c&&c(),d.splice(d.indexOf(e),1)}}var s,t=this;this.documents=function(){return d.store},this.initServices=function(){b.init(),i.init()};var u={};this.retrieveTokens=function(){return b.reset(),t.deselectAll(),l()?void t.checkLoadStatus():void angular.forEach(s,function(a){a.get(function(c){b.addSentences(c),n(),u=b.currentChunk(),o(a.preselections),v(a)})})},this.checkLoadStatus=function(){var b=!0;if(angular.forEach(s,function(a){b=b&&a.loaded}),b){var c=function(){t.launched=!0,t.replaceState(u,!0)};d.hasAdditionalConfs()?a.loadAdditionalConf(d.confs)["finally"](c):c()}};var v=function(a){a.loaded=!0,t.checkLoadStatus()};this.asString=function(a){return t.tokens[a].string},this.getToken=function(a){return t.tokens[a]||{}},this.selectedTokens={},this.clickedTokens={},this.hasSelections=function(){return 0!==Object.keys(t.selectedTokens).length},this.hasClickSelections=function(){return Object.keys(t.clickedTokens).length},this.isSelected=function(a){return a in this.selectedTokens},this.isClicked=function(a){return a in this.clickedTokens},this.multiSelect=function(a){t.deselectAll(),p(a)},this.selectToken=function(a,b){"click"===b&&t.deselectAll(),t.isSelectable(t.selectionType(a),b)&&(t.selectedTokens[a]=b,"hover"!==b&&(t.clickedTokens[a]=b))},this.selectionType=function(a){return t.selectedTokens[a]},this.isSelectable=function(a,b){return"hover"===a&&"hover"!==b||!a},this.deselectToken=function(a,b){t.selectionType(a)===b&&(delete t.selectedTokens[a],delete t.clickedTokens[a])},this.toggleSelection=function(a,b){this.isSelected(a)&&this.selectionType(a)==b?this.deselectToken(a,b):this.selectToken(a,b)},this.deselectAll=function(){for(var a in t.selectedTokens)delete t.selectedTokens[a],delete t.clickedTokens[a]},this.firstSelected=function(){return Object.keys(t.selectedTokens)[0]},this.selectSurroundingToken=function(a){var b,c=t.firstSelected(),d=Object.keys(t.tokens),e=d.indexOf(c);switch(a){case"next":b=d[e+1]||d[0];break;case"prev":b=d[e-1]||d[d.length-1]}t.deselectAll(),t.selectToken(b,"click")},this.selectNextToken=function(){t.selectSurroundingToken("next")},this.selectPrevToken=function(){t.selectSurroundingToken("prev")},this.toTokenStrings=function(a){var b=h.nonSequentialIds(a),c=[];return angular.forEach(a,function(a,d){c.push(t.asString(a)),b[d]&&c.push("...")}),c.join(" ")},this.setState=function(a,b,c){j.log("state.setState is DEPRECATED. Use state.change() instead.");var d=t.tokens[a];if(d){{d[b]}d[b]=c}},this.unsetState=function(a,b){{var c=t.tokens[a];c[b]}delete c[b]},this.replaceState=function(a,b){b||t.deselectAll(),t.tokens=a,t.launched&&t.broadcast("stateLoaded")},this.setStyle=function(a,b){t.getToken(a).style=b},this.addStyle=function(a,b){var c=t.getToken(a);c.style||(c.style={}),angular.extend(c.style,b)},this.unapplyStylings=function(){angular.forEach(t.tokens,function(a,b){t.unsetStyle(b)})},this.removeStyle=function(a,b){var c=t.getToken(a).style;if(c){var d=arethusaUtil.toAry(b);angular.forEach(d,function(a){delete c[a]})}},this.unsetStyle=function(a){t.getToken(a).style={}},this.addStatusObjects=function(){angular.forEach(t.tokens,q)},this.countTotalTokens=function(){t.totalTokens=Object.keys(t.tokens).length},this.countTokens=function(a){var b=0;return angular.forEach(t.tokens,function(c){a(c)&&b++}),b},this.addToken=function(a,c){t.tokens[c]=a,q(a),b.addToken(a),t.countTotalTokens(),t.broadcast("tokenAdded",a)},this.removeToken=function(a){var c=t.getToken(a);t.doBatched(function(){t.broadcast("tokenRemoved",c),delete t.tokens[a]}),b.removeToken(c),t.deselectAll(),t.countTotalTokens()},this.lazyChange=function(a,b,c,d,e){return new g(t,a,b,c,d,e)},this.change=function(a,b,c,d,e){var f=t.lazyChange(a,b,c,d,e);return i.shouldDeselect(b)&&t.deselectAll(),f.exec()},this.notifyWatchers=function(a){function b(b){b.exec(a.newVal,a.oldVal,a)}var c=w[a.property]||[];angular.forEach(c,b),angular.forEach(w["*"],b)};var w={"*":[]};this.watch=function(a,b,c){var d=w[a];d||(d=w[a]=[]);var e=new r(a,b,c,d);return d.push(e),e.destroy},this.on=function(a,b){c.$on(a,b)},this.broadcast=function(a,b){c.$broadcast(a,b)},this.doSilent=function(a){t.silent=!0,a(),t.silent=!1},this.doBatched=function(a){t.batchChangeStart(),a(),t.batchChangeStop()},this.batchChangeStart=function(){t.batchChange=!0},this.batchChangeStop=function(){t.batchChange=!1,t.broadcast("batchChangeStop")},this.postInit=function(){t.addStatusObjects(),t.countTotalTokens()},this.init=function(){k(),t.retrieveTokens()}}]),angular.module("arethusa.core").factory("StateChange",["$parse",function(a){function b(a,b){return angular.isObject(b)?b:a.getToken(b)}return function(c,d,e,f,g,h){function i(){c.change(j.token,e,j.oldVal)}var j=this,k=a(e),l=k.assign;this.token=b(c,d),this.property=e,this.newVal=f,this.oldVal=k(j.token),this.type="change",this.time=new Date,this.undo=function(){return angular.isFunction(g)?g():i()},this.exec=function(){return angular.isFunction(h)&&h(),l(j.token,j.newVal),c.broadcast("tokenChange",j),c.notifyWatchers(j),j}}}]),angular.module("arethusa.core").factory("StateChangeWatcher",["state",function(a){return function(b,c,d){var e=this;this.initCount=function(){e.count=0,e.matchingTokens={},angular.forEach(a.tokens,function(a){c(a)||(e.count++,e.matchingTokens[a.id]=!0)}),d.changedCount(e.count)},this.watchChange=function(a,b,c){var f=c.token.id;a?b||(e.count--,delete e.matchingTokens[f],d.lostMatch(c.token),d.changedCount(e.count)):(e.count++,e.matchingTokens[f]=!0,d.newMatch(c.token),d.changedCount(e.count))},this.applyToMatching=function(a){angular.forEach(e.matchingTokens,function(b,c){a(c)})},a.watch(b,this.watchChange)}}]),angular.module("arethusa.core").factory("translator",["$rootScope","$translate",function(a,b){function c(a,b){var c={};return c.start=a[b+".start"],c.end=a[b+".end"],c}function d(a,d,e,f){var g=f?[a+".start",a+".end"]:a;b(g).then(function(b){f&&(b=c(b,a)),angular.isFunction(d)?d(b):arethusaUtil.setProperty(d,e,b)})}return function(b,c,e,f){d(b,c,e,f),a.$on("$translateChangeSuccess",function(){d(b,c,e,f)})}}]),angular.module("arethusa.core").factory("Tree",["$compile","languageSettings","keyCapture","idHandler","$window","state","$timeout","translator","plugins","navigator",function(a,b,c,d,e,f,g,h,i,j){return function(k,l,m){function n(){qb();var a,b;a=d3.event,b="translate("+a.translate+") scale("+a.scale+")",Hb.vis.attr("transform",b)}function o(){return'<span root-token root-id="'+Fb+'" sentence-id="'+S()+'">'+Mb+"</span>"}function p(a){return"templates/arethusa.dep_tree/"+a+".html"}function q(b){var c='<span ng-include="'+b+'"/>';l.prepend(a(c)(k))}function r(){return'<div id="tph'+Fb+'">'+Mb+"</div>"}function s(a){return'<div class="node token-node" id="tph'+a.id+'">'+a.string+"</div>"}function t(a){var b="xxxxxxxxxxx",c=a.id,d="text-center tree-label";return'<div id="'+H(c)+'" class="'+d+'">'+b+"</div>"}function u(b){var c=k.$new();return Hb.childScopes.push(c),c.obj=b.relation,a(Vb)(c)[0]}function v(b){var c=k.$new();Hb.childScopes.push(c),c.token=b;var d;return k.styles?(w(b)&&x(c,b),d="style"):d="true",a(Ub.replace("STYLE",d))(c)[0]}function w(a){var b=k.styles[a.id]||{};return b.token}function x(a,b){a.style=k.styles[b.id].token}function y(){Hb.vis.selectAll("g.edgePath path");angular.forEach(k.styles,function(a,b){var c=a.label,d=a.edge;c&&(z(b,G(b),c,Xb),G(b).style(c)),d&&(z(b,D(b),d,Wb),D(b).style(d))})}function z(a,b,c,d){if(c){var e={};angular.forEach(c,function(a,c){e[c]=b.style(c)}),d[a]=e}}function A(){angular.forEach(Wb,function(a,b){D(b).style(a)}),Wb={}}function B(){angular.forEach(Xb,function(a,b){G(b).style(a)}),Xb={}}function C(){return Hb.vis.selectAll("g.edgePath path")}function D(a){return Hb.vis.select("#"+F(a))}function E(a){return D(a)[0][0]}function F(a){return"tep"+a}function G(a){return Hb.vis.select("#"+H(a))}function H(a){return"tel"+a}function I(a){return"tph"+a}function J(a){return Hb.vis.select("#"+I(a))}function K(){return Hb.vis.selectAll("div.node.token-node")}function L(){return Hb.vis.selectAll(function(){return this.getElementsByTagName("foreignObject")})}function M(a){return Hb.g._nodes[a]}function N(a){return aU.getProperty(a,m.mainAttribute)}function O(a,b){return a&&b?angular.equals(Object.keys(a),Object.keys(b)):void 0}function P(a){if(tb()){a||Q();var b=k.current;if(k.current=k.groupedTokens[k.currentFocus],O(k.current,b))return}else k.current=k.tokens;R(),Hb.g=new dagreD3.Digraph,m.syntheticRoot&&T(),V(),$()}function Q(){k.groupedTokens=aU.map(j.currentSentences,"tokens"),k.groupSize=k.groupedTokens.length}function R(){Hb.vis&&Hb.vis.selectAll("*").remove()}function S(){for(var a in k.current)break;return k.current[a].sentenceId}function T(){Fb=d.getId("0",S()),Hb.g.addNode(Fb,{label:r()})}function U(a){Hb.g.addNode(a.id,{label:s(a)})}function V(){angular.forEach(k.current,function(a){N(a)&&Hb.drawEdge(a)})}function W(a){E(a.id)&&Hb.g.delEdge(a.id),Hb.drawEdge(a)}function X(a){a.$destroy()}function Y(){angular.forEach(Hb.childScopes,X),Hb.childScopes=[]}function Z(){Y(),m.syntheticRoot&&_(),Hb.insertNodeDirectives(),Hb.insertEdgeDirectives()}function $(){Hb.vis=Rb.select("g"),Tb.layout(k.layout).run(Hb.g,Hb.vis),Z(),C().each(function(a){angular.element(this).attr("id",F(a))}).attr("marker-end","");var a=L();a.each(function(){angular.element(this.children[0]).attr("style","float: center;"),angular.element(this).attr("overflow","visible")}),g(function(){l.find(".token").removeClass("no-transition")})}function _(){J(Fb).append(function(){return this.textContent="",a(o())(k)[0]})}function ab(){Hb.insertTokenDirectives()}function bb(){K().append(function(){return this.textContent="",v(k.current[this.id.slice(3)])})}function cb(){angular.forEach(k.current,function(a,b){G(b).append(function(){this.textContent="";var b=u(a);return b})})}function db(){k.nodeSep=30,k.edgeSep=10,k.rankSep=30}function eb(){k.nodeSep=80,k.edgeSep=5,k.rankSep=40}function fb(){var a=b.getFor("treebank");return a?a.leftToRight:!0}function gb(a,b,c){ib(a,b,c);var d="translate("+a+","+b+" )",e=c?" scale("+c+")":"";Hb.vis.transition().attr("transform",d+e).duration(Lb).ease()}function hb(a,b){if(a){b=b||Ib;var c=nb(a),d=Pb-c.x,e=0-c.y+b;gb(d,e)}}function ib(a,b,c){Sb.translate([a,b]),Sb.scale(c||1)}function jb(){return Hb.vis.node().getBBox()}function kb(){Ob=Kb.width(),Nb=Kb.height(),Pb=Ob/2,Qb=Nb/2}function lb(a,b){this.x=a,this.y=b}function mb(a){var b=a.attr("transform"),c=/translate\((.*),(.*?)\)/.exec(b);return new lb(c[1],c[2])}function nb(a){var b=angular.element(J(a)[0]);return mb(b.parents(".node"))}function ob(){angular.isDefined(Gb)&&Gb()}function pb(a){Gb=a}function qb(){Gb=void 0}function rb(){jb().width>Ob-2*Ib?k.perfectWidth():k.centerGraph()}function sb(a){P(a),rb(),tb()&&i.declareReady(m.parentPlugin)}function tb(){return k.tokens===f.tokens}function ub(a){return k.current[a]}function vb(a){return{tree:[a.create("directionChange",function(){k.changeDir()},"x"),a.create("centerTree",function(){k.centerGraph()},"s"),a.create("focusRoot",function(){k.focusRoot()}),a.create("focusSelection",function(){k.focusSelection()},"a"),a.create("perfectWidth",function(){k.perfectWidth()},"d")]}}function wb(){k.compactTree=Hb.compactTree,k.wideTree=Hb.wideTree,k.textDirection=fb(),k.rankDir="BT","vertical"===m.direction&&k.changeDir(),k.compactTree(),k.layout=dagreD3.layout().sortRankByIdAscending(k.textDirection).rankDir(k.rankDir).nodeSep(k.nodeSep).edgeSep(k.edgeSep).rankSep(k.rankSep)}function xb(){wb(),k.currentFocus=0,k.$watch("tokens",function(){sb()}),k.$watch("currentFocus",function(a,b){a!==b&&sb(!0)}),yb(),l.append(Kb),q("focusTemplate"),q("panelTemplate"),l.prepend(a("<div dep-tree-navigator/>")(k)),kb()}function yb(){Ab()||Db()?$b.addClass("no-border"):$b.removeClass("no-border")}function zb(){return l.parents(".gridster")}function Ab(){return zb().length}function Bb(){return zb().hasClass("gridster-loaded")}function Cb(){return l.parents("#sidepanel")}function Db(){return Cb().length}function Eb(){}var Fb,Gb,Hb=this,Ib=15,Jb='        <svg class="full-height full-width">          <g transform="translate('+Ib+","+Ib+')"/>        </svg>      ',Kb=angular.element(Jb),Lb=700,Mb="[ROOT]";this.g=void 0,this.vis=void 0;var Nb,Ob,Pb,Qb,Rb=d3.select(l[0]),Sb=d3.behavior.zoom();Rb.call(Sb.on("zoom",n).scaleExtent([.3,2.5]));var Tb=new dagreD3.Renderer;Tb.transition(function(a){return a.transition().duration(Lb)}),k.settingsOn=!1;var Ub='        <span token="token"          class="no-transition"          colorize="STYLE"          click="true"          hover="true"/>      ',Vb='        <span         value-watch         target="obj"         property="label"         empty-val="NIL"/>      ';k.focusTemplate=p("focus_controls"),k.panelTemplate=p("settings");var Wb={},Xb={};this.drawEdge=function(a){var b=a.id;if(angular.isDefined(b)){var c=aU.getProperty(a,m.mainAttribute);M(b)||U(a),M(c)||U(k.current[c]),Hb.g.addEdge(b,b,c,{label:t(a)})}},k.changeDir=function(){var a;fb()?a="RL":(a="LR",k.textDirection=!k.textDirection),k.rankDir="BT"===k.rankDir?a:"BT"},k.centerGraph=function(){pb(k.centerGraph);var a=(Ob-jb().width)/2;gb(a,Ib)},k.perfectWidth=function(){pb(k.perfectWidth);var a=jb().width,b=Ob-2*Ib,c=b/a;gb(Ib,Ib,c)},k.focusRoot=function(){pb(k.focusRoot),hb(Fb)},k.focusSelection=function(){pb(k.focusSelection),hb(f.firstSelected(),Nb/3)},k.$watch("styles",function(a,b){a!==b&&(Z(),a?y():(A(),B()))});var Yb={nodeSep:function(a){k.layout.nodeSep(a)},edgeSep:function(a){k.layout.edgeSep(a)},rankSep:function(a){k.layout.rankSep(a)},rankDir:function(a){k.layout.rankDir(a)},textDirection:function(a){k.layout.sortRankByIdAscending(a)}};if(angular.forEach(Yb,function(a,b){k.$watch(b,function(b,c){b!==c&&(a(b),$(),g(ob,Lb))})}),tb()){f.on("tokenAdded",function(a,b){ub(b.id)&&(U(b),Z(),$())}),f.on("tokenRemoved",function(a,b){var c=b.id;ub(c)&&M(c)&&(Hb.g.delNode(c),$())});var Zb;f.watch(m.mainAttribute,function(a,b,c){var d=c.token;if(ub(d.id)){if(a!==b&&(""===a?Hb.g.delEdge(d.id):W(d)),f.batchChange)return void(Zb=!0);$(),g(ob,Lb)}}),f.on("batchChangeStop",function(){Zb&&($(),g(ob,Lb),Zb=!1)})}angular.element(e).on("resize",function(){kb(),ob()});var $b=l.parents(".tree-canvas"),_b=c.initCaptures(vb);k.keyHints=arethusaUtil.inject({},_b.tree,function(a,b,c){a[b]=arethusaUtil.formatKeyHint(c)}),k.translations={};var ac=["changeDir","focusRoot","focusSel","centerTree","perfectWidth","compact","widen"];angular.forEach(ac,function(a){h("tree."+a,k.translations,a)}),this.launch=function(){Ab()&&!Bb()?g(xb,130):xb()},this.createEdges=Eb,this.nodePresent=M,this.createNode=U,this.insertNodeDirectives=ab,this.insertTokenDirectives=bb,this.insertEdgeDirectives=cb,this.compactTree=db,this.wideTree=eb,this.childScopes=[]}}]),angular.module("arethusa.core").factory("urlParser",[function(){function a(a){var b=a.search.slice(1),c=b.split("&");return arethusaUtil.inject({},c,function(a,b){var c=b.split("="),d=c[0],e=c[1]||!0,f=a[d],g=f?arethusaUtil.toAry(f).concat([e]):e;a[d]=g})}function b(a,b){return a+"="+b}function c(a,c){var d=a.url.replace(c.search,"?"),e=[];angular.forEach(a.params,function(a,c){angular.isArray(a)?angular.forEach(a,function(a){e.push(b(c,a))}):e.push(b(c,a))}),a.url=d+e.join("&")}function d(b){var d=this,e=document.createElement("a");e.href=b,this.url=b,this.params=a(e),this.set=function(a,b){angular.isString(a)&&b&&(this.params[a]=b),c(d,e)}}return function(a){return new d(a)}}]),angular.module("arethusa.core").factory("User",[function(){return function(a){this.name=a.name,this.fullName=a.fullName,this.mail=a.mail,this.page=a.page}}]),angular.module("arethusa.core").service("userPreferences",["globalSettings","arethusaLocalStorage",function(a,b){function c(a){return f+"."+a}function d(a,d,e){b.set(c(a+"."+d),e)}function e(a,d){return b.get(c(a+"."+d))}var f="preferences";this.set=function(b,c,e){a.persistSettings&&d(b,c,e)},this.get=e}]),angular.module("arethusa.core").service("versioner",["VERSION",function(a){function b(a){return c.repository+"/tree/"+a}var c=this;angular.extend(this,a),this.commitUrl=b(a.revision),this.branchUrl=b(a.branch)}]),angular.module("arethusa.core").run(["$templateCache",function(a){"use strict";a.put("templates/arethusa.core/arethusa_grid.html",'<div gridster="grid.options">\n  <ul>\n    <li\n      gridster-item="item"\n      ng-style="item.style"\n      ng-repeat="item in grid.items track by item.plugin">\n      <arethusa-grid-handle>Handle</arethusa-grid-handle>\n      <plugin name="{{ item.plugin }}"></plugin>\n    </li>\n  </ul>\n</div>\n'),a.put("templates/arethusa.core/arethusa_grid_handle.html",'<div class="drag-handle-trigger">\n  <div class="drag-handle fade" ng-show="visible">\n    <div class="drag-handle">\n      <span>{{ item.plugin }}</span>\n      <span ng-show="plugin.settings" settings-trigger="right"/>\n      <div ng-if="settingsOn"\n        style="padding: .3rem 1rem; text-align: right"\n        class="fade">\n        <div\n          ng-repeat="setting in plugin.settings">\n          <div ng-if="setting.directive" dynamic-directive="{{ setting.directive }}"/>\n          <div ng-if="!setting.directive" plugin-setting/>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),a.put("templates/arethusa.core/arethusa_tabs.html",'<tabset>\n  <tab\n    ng-repeat="pl in tabs"\n    select="plugins.setActive(pl)"\n    heading="{{ pl.displayName }}"\n    active="plugins.isSelected(pl)">\n    <plugin\n      name="{{ pl.name }}"\n      with-settings="true"\n      ng-if="plugins.isActive(pl)">\n    </plugin>\n  </tab>\n</tabset>\n\n'),a.put("templates/arethusa.core/arethusa_user.html",'<span>\n  <a ng-href="{{ user.page }}" target="_blank">{{ name }}</a>\n</span>\n<span ng-if="withMail && user.mail" style="margin-left: .5rem">\n  <a ng-href="mailto:{{ user.mail }}">\n    <i class="fi-mail"></i>\n  </a>\n</span>\n'),a.put("templates/arethusa.core/chunk_mode_switcher.html",'<div>\n  <label>\n    <span translate="globalSettings.chunkMode"/>\n    <select\n      style="width: 8rem"\n      class="compact"\n      ng-model="navi.chunkMode"\n      ng-change="navi.applyChunkMode()"\n      ng-options="mode as mode for mode in navi.chunkModes">\n    </select>\n\n    <form ng-submit="tryToSetChunkSize()" style="display: inline-block">\n      <input\n        style="width: 2rem"\n        class="compact"\n        type="text" ng-model="size"/>\n    </form>\n  </label>\n</div>\n\n'),a.put("templates/arethusa.core/colorizer_setting.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.applyColorizer()"\n    ng-options="k as k for (k, v) in gS.colorizers">\n  </select>\n</label>\n'),a.put("templates/arethusa.core/editors.html",'<ul ng-if="editors.editorsPresent" class="no-list">\n  <li ng-repeat="(doc, users) in editors.perDocument">\n     <strong>{{ doc }}</strong>\n     <ul class="no-list">\n       <li ng-repeat="user in users">\n          <div arethusa-user="user" with-mail="true"/>\n       </li>\n     </ul>\n  </li>\n</ul>\n\n<div ng-if="!editors.editorsPresent" translate="editors.noEditorsPresent"/>\n'),a.put("templates/arethusa.core/foreign_keys_help.html",'<div ng-if="visible">\n  <ul id="keyboard">\n    <li ng-repeat="key in keys"\n      id="{{ key.lower }}"\n      ng-click="generate(key.lower)"\n      ng-class="key.style.class"\n      class="keyboard-key">\n      <span ng-repeat="char in key.show"\n        class="shifted-{{$index}}"\n        ng-class="key.style.class[{{$index}}]">{{ char }}</span>\n    </li>\n  </ul>\n  <div delimiter/>\n</div>\n'),a.put("templates/arethusa.core/global_click_action.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.setClickAction(gS[setting.property])"\n    ng-options="k as k for (k, v) in gS.clickActions">\n  </select>\n</label>\n'),a.put("templates/arethusa.core/global_settings_panel.html",'<div ng-if="active" class="fade">\n  <p class="text" translate="globalSettings.title"/>\n  <div class="small-12 columns scrollable text">\n    <ul class="no-list in-columns" style="height: 240px">\n      <li\n        class="fade"\n        ng-repeat="name in gS.settings | keys"\n        ng-init="setting = gS.settings[name]">\n        <div ng-switch="setting.type">\n          <div\n            ng-switch-when="custom"\n            dynamic-directive="{{ setting.directive }}"/>\n          <div ng-switch-default>\n            <input\n              type="{{ setting.type }}"\n              ng-change="gS.propagateSetting(setting.property)"\n              ng-model="gS[setting.property]"/>\n            <label>\n              <span translate="{{ setting.label }}"/>\n            </label>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n'),a.put("templates/arethusa.core/grid_items.html",'<br/>\n<div>\n  <p class="text">\n    <span>Grid</span>\n    <span translate="items"></span>\n  </p>\n  <ul class="no-list in-columns">\n    <li ng-repeat="(name, status) in grid.itemList">\n      <input\n        style="margin-bottom: 0.3rem"\n        type="checkbox"\n        ng-change="grid.toggleItem(name)"\n        ng-model="grid.itemList[name]"/>\n      <label>\n        {{ name }}\n      </label>\n    </li>\n  </ul>\n</div>\n'),a.put("templates/arethusa.core/grid_setting.html",'<div style="display: inline-block">\n  <p class="text">\n    <span>Grid</span>\n    <span translate="settings"></span>\n  </p>\n  <ul class="no-list">\n    <li ng-repeat="(key, value) in settings">\n      <input\n        type="checkbox"\n        ng-model="settings[key]"/>\n      <label>\n        <span translate="grid.{{ key }}"/>\n      </label>\n    </li>\n  </ul>\n</div>\n'),a.put("templates/arethusa.core/help_panel.html",'<div ng-if="active" class="fade small-12-columns">\n  <div class="small-6 large-6 columns">\n    <div help-panel-item toggler="colors" heading="helpPanel.colorLegends" height="400px">\n      <ul class="no-list" ng-repeat="(name, values) in gS.colorMaps()">\n        <li\n          ng-class="{ \'active-colorizer\': name === gS.colorizer }">\n          {{ name }}\n        </li>\n        <ul class="no-list" ng-repeat="map in values.maps">\n          <li>\n            {{ map.label }}\n            <table class="small">\n              <tr>\n                <th ng-repeat="header in values.header">\n                  <strong>{{ header }}</strong>\n                </th>\n              </tr>\n              <tr ng-repeat="(k, col) in map.colors">\n                <td\n                  ng-style="col"\n                  ng-repeat="val in k.split(\' || \') track by $index">\n                  {{ val }}\n                </td>\n              </tr>\n            </table>\n          </li>\n        </ul>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="messages" heading="messages" height="200px">\n      <ul class="no-list">\n        <li ng-repeat="message in notifier.messages">\n          <div class="notification-list-item">\n            <span class="time">{{ message.time | date: "HH:mm:ss" }}</span>\n            <span class="message toast-{{ message.type }}">{{ message.message }}</span>\n          </div>\n        </li>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="editors" heading="editors.title" height="200px">\n      <div editors/>\n    </div>\n  </div>\n\n  <div class="small-6 large-6 columns">\n    <div help-panel-item toggler="keys" heading="helpPanel.keyboardShortcuts" height="400px">\n      <ul class="no-list" ng-repeat="(section, keys) in kC.activeKeys">\n        <li>{{ section }}</li>\n        <table class="small">\n          <tr ng-repeat="(name, key) in keys">\n            <td><strong>{{ key }}</strong></td><td>{{ name}}</td>\n          </tr>\n        </table>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="about" heading="helpPanel.about" height="125px">\n      <ul class="no-list">\n        <li>\n          <table class="small">\n            <tr>\n              <td translate="helpPanel.revision"/>\n              <td>\n                <a ng-href="{{ vers.commitUrl }}" target="_blank">\n                  {{ vers.revision }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              <!--This is untranslated on purpose!-->\n              <td>Branch</td>\n              <td>\n                <a ng-href="{{ vers.branchUrl }}" target="_blank">\n                  {{ vers.branch }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              <td translate="date"/>\n              <td>{{ vers.date | date: \'medium\' }}</td>\n            <tr>\n          </table>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),a.put("templates/arethusa.core/help_panel_item.html",'<div delimiter/>\n<div class="text">\n  <div help-panel-heading toggler="{{ toggler }}" heading="{{ heading }}"/>\n  <div\n    class="small-12 columns scrollable slider"\n    style="height: {{ height }}"\n    ng-if="visible[toggler]"\n    ng-transclude>\n  </div>\n</div>\n'),a.put("templates/arethusa.core/keys_to_screen.html",'<div id="keys-to-screen">\n  <span\n    ng-repeat="key in keys"\n    class="key-to-screen"\n    ng-class="{ joiner: key.joiner }">{{ key.str }}</span>\n  <span ng-repeat="action in actions"\n    class="text italic right action">\n      {{ action.str }}\n  </span>\n</div>\n'),a.put("templates/arethusa.core/layout_setting.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.broadcastLayoutChange()"\n    ng-options="layout.name for layout in gS.layouts">\n  </select>\n</label>\n'),a.put("templates/arethusa.core/navbar_buttons.html",'<li><a class="button" saver/></li>\n<li><a class="button" outputter/></li>\n<li><a class="button" hist-undo/></li>\n<li><a class="button" hist-redo/></li>\n<li><a class="button" sidepanel-folder/></li>\n<li><a class="button" deselector/></li>\n<li><a class="button" uservoice-trigger/></li>\n<li><a class="button" global-settings-trigger/></li>\n<li><a class="button" help-trigger/></li>\n<li><a class="button" translate-language/></li>\n<li><a class="button" exit/></li>\n\n'),a.put("templates/arethusa.core/navbar_buttons_collapsed.html",'<li>\n  <a\n    class="button"\n    title="{{ translations.menu }}"\n    dropdown-toggle="#navbar_collapsed_buttons_menu">\n    <i class="fi-align-justify"></i>\n  </a>\n  <ul id="navbar_collapsed_buttons_menu" class="navbar-dropdown">\n    <li><a saver/></li>\n    <li><a outputter/></li>\n    <li><a hist-undo/></li>\n    <li><a hist-redo/></li>\n    <li><a sidepanel-folder/></li>\n    <li><a deselector/></li>\n    <li><a uservoice-trigger/></li>\n    <li><a help-trigger/></li>\n    <li><a global-settings-trigger/></li>\n    <li><a translate-language/></li>\n    <li><a exit/></li>\n  </ul>\n</li>\n'),a.put("templates/arethusa.core/navbar_navigation.html",'<ul ng-show="showNavigation()">\n  <li>\n    <a>{{ navStat.citation }}</a>\n  </li>\n  <!--The wrapping divs around the a elements are only there for styling - the-->\n  <!--foundation topbar gives them a differnet look and feel when they are wrapped.-->\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToFirst }}"\n        ng-click="goToFirst()"\n        ng-class="{ disabled: !navStat.hasPrev }">\n        <i class="fi-previous"></i>\n      </a>\n    </div>\n  </li>\n  <li>\n  <div>\n    <a\n      class="nav-link"\n      title="{{ trsls.goToPrev }}"\n      ng-click="prev()"\n      ng-class="{ disabled: !navStat.hasPrev }">\n      <i class="fi-arrow-left"></i>\n    </a>\n  </div>\n  </li>\n  <li>\n    <div>\n      <ul class="navigation">\n        <li>\n          <a>\n            {{ ids }}\n          </a>\n          <ul>\n            <div class="navigation-menu small-12 large-12 columns">\n              <div>\n                <form ng-submit="goTo(goToLocation)">\n                  <input class="inline" type="text" ng-model="goToLocation"/>\n                </form>\n              </div>\n              <div>\n                <a sentence-list translate="list"/>\n              </div>\n            </div>\n          </ul>\n        </li>\n      </ul>\n    </div>\n  </li>\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToNext }}"\n        ng-click="next()"\n        ng-class="{ disabled: !navStat.hasNext }">\n        <i class="fi-arrow-right"></i>\n    </a>\n  </div>\n  </li>\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToLast }}"\n        ng-click="goToLast()"\n        ng-class="{ disabled: !navStat.hasNext }">\n        <i class="fi-next"></i>\n      </a>\n    </div>\n  </li>\n</ul>\n'),a.put("templates/arethusa.core/navbar_notifier.html",'<ul ng-show="showNotifier()">\n  <span current-message/>\n</ul>\n\n'),a.put("templates/arethusa.core/navbar_search.html",'<ul ng-show="showSearch()">\n  <li class="has-form">\n    <div class="row collapse">\n      <div class="large-10 small-10 columns">\n        <form ng-submit="search()">\n          <input\n            type="text"\n            ng-model="query"\n            placeholder="{{ search_documents }}...">\n        </form>\n      </div>\n      <div class="large-2 small-2 columns">\n        <button class="alert button expand" ng-click="search()">\n          <i class="fi-magnifying-glass"></i>\n        </button>\n      </div>\n    </div>\n  </li>\n</ul>\n'),a.put("templates/arethusa.core/notifications.html","<toaster-container\n  toaster-options=\"{\n    'close-button': true,\n    'position-class': 'toast-bottom-right'\n  }\">\n</toaster-container>\n"),a.put("templates/arethusa.core/outputter.html",'<div class="outputter">\n  <div outputter-item ng-repeat="(name, obj) in saver.outputters"/>\n</div>\n'),a.put("templates/arethusa.core/outputter_item.html",'<div>\n  <span class="italic">{{ obj.identifier }}</span>\n  <span class="buttons">\n    <span\n      class="button radius micro"\n      ng-class="{ on: preview }"\n      ng-click="togglePreview()"\n      translate="preview">\n    </span>\n    <span\n      class="button radius micro"\n      ng-click="download()"\n      translate="download">\n    </span>\n  </span>\n</div>\n<div delimiter/>\n<div ng-if="preview" hljs class="preview fade" source="data()"/>\n\n'),a.put("templates/arethusa.core/plugin.html",'<div\n  id="{{ plugin.name }}"\n  class="fade very-slow">\n  <div ng-if="withSettings && plugin.settings" plugin-settings/>\n  <div ng-include="plugin.template"/>\n</div>\n'),a.put("templates/arethusa.core/plugin_setting.html",'<label ng-if="!setting.directive" class="margined-hor-tiny">\n  {{ setting.label }}\n  <input\n    type="checkbox"\n    style="margin: 0"\n    ng-change="change()"\n    ng-model="plugin[setting.model]"/>\n</label>\n'),a.put("templates/arethusa.core/plugin_settings.html",'<div class="small-12 columns">\n  <span settings-trigger="right"/>\n  <span ng-show="settingsOn">\n    <span ng-repeat="setting in plugin.settings" class="right">\n      <span ng-if="setting.directive" dynamic-directive="{{ setting.directive }}"/>\n      <span ng-if="!setting.directive" plugin-setting/>\n    </span>\n  </span>\n</div>\n'),a.put("templates/arethusa.core/sentence.html",'<div\n  ng-click="goTo(id)">\n  <table class="sentence-list" ng-class="{ changed: sentence.changed }">\n    <tr class="sentence-list">\n      <td>{{ citation }} {{ id }}</td>\n      <td>{{ sentenceString }}</td>\n    </tr>\n  </table>\n</div>\n\n'),a.put("templates/arethusa.core/settings_trigger.html",'<span\n  class="clickable"\n  ng-click="settingsOn = !settingsOn">\n  <i class="fi-widget" style="font-size: 1.2rem"></i>\n</span>\n\n'),a.put("templates/arethusa.core/translate_language.html",'<div class="flags {{ lang }}"/>\n')
}]),angular.module("arethusa.contextMenu",[]),angular.module("arethusa.contextMenu").directive("arethusaContextMenu",[function(){return{restrict:"AE",scope:{token:"=tokenObj",plugins:"="},link:function(){},templateUrl:"templates/arethusa.context_menu/arethusa_context_menu.html"}}]),angular.module("arethusa.contextMenu").directive("arethusaContextMenus",[function(){return{restrict:"A",scope:{tokens:"=",plugins:"="},link:function(a){a.fullId=function(a){return a.sentenceId+a.id}},template:'        <arethusa-context-menu          ng-repeat="(id, token) in tokens track by id"          plugins="plugins"          token-obj="token">        </arethusa-context-menu>      '}}]),angular.module("arethusa.contextMenu").factory("menuElement",function(){return{element:null}}).directive("contextMenu",["$document","$parse","menuElement","keyCapture",function(a,b,c,d){return{restrict:"A",scope:{menuObj:"=",menuTrigger:"@",menuPosition:"@"},link:function(e,f,g){function h(a,b){var c,d,f=b.offset();"bottom"===e.menuPosition&&(d=f.top+b.outerHeight(),c=f.left),"right"===e.menuPosition&&(d=f.top,c=f.left+b.outerWidth()),a.css("left",c),a.css("top",d)}function i(a,b,d){b.addClass("menu-open"),b.css("display","inline-block"),h(b,d),c.lastTarget=a.target,e.menuObj&&(e.menuObj.status.contextMenuOpen=!0),p=!0}function j(a){a.removeClass("menu-open"),a.css("display","none"),c.lastTarget=void 0,e.menuObj&&(e.menuObj.status.contextMenuOpen=!1),p=!1}function k(){e.$apply(function(){j(c.element)})}function l(a){return a.target===c.lastTarget&&a.button===o()}function m(a){if(p){if(n(a.target))return;if(l(a))return;k()}}function n(a){var b=angular.element(a),d=c.element;return b.parents("#"+d.attr("id")).length}function o(){var a={rightclick:2,click:1};return a[e.menuTrigger]}var p=!1,q=b(g.contextMenu),r=function(){return"rightclick"==e.menuTrigger?"contextmenu":"click"==e.menuTrigger?"click":void 0}();f.bind(r,function(a){c.element&&j(c.element),c.element=angular.element(document.getElementById(g.menuId)),a.preventDefault(),a.stopPropagation(),e.$apply(function(){q(e,{$event:a}),i(a,c.element,f)})}),a.on("click",m),e.$on("$destroy",function(){a.off("click",m)}),d.onKeyPressed("esc",function(){p&&(k(),d.stopPropagation())},1e3)}}}]),angular.module("arethusa.contextMenu").directive("pluginContextMenu",function(){return{restrict:"E",scope:!0,replace:!0,template:'      <div id="{{ plugin.name }}-context-menu"        ng-include="plugin.contextMenuTemplate">      </div>    '}}),angular.module("arethusa.contextMenu").run(["$templateCache",function(a){"use strict";a.put("templates/arethusa.context_menu/arethusa_context_menu.html",'<div id="tcm{{ token.id }}" class="token-context-menu">\n  <div ng-if="token.status.contextMenuOpen">\n    <div ng-repeat="plugin in plugins">\n      <plugin-context-menu class="menu-element"></plugin-context-menu>\n    </div>\n  </div>\n</div>\n')}]),angular.module("arethusa.history",[]),angular.module("arethusa.history").directive("histRedo",["generator","history","translator",function(a,b,c){return a.historyTrigger(b,c,"redo","repeat")}]),angular.module("arethusa.history").directive("histUndo",["generator","history","translator",function(a,b,c){return a.historyTrigger(b,c,"undo")}]),angular.module("arethusa.history").directive("historyBatch",function(){return{restrict:"A",scope:{batch:"=historyBatch"},link:function(a){a.events=a.batch.events},templateUrl:"templates/arethusa.history/history_batch.html"}}),angular.module("arethusa.history").directive("historyEvent",["idHandler","$compile",function(a,b){return{restrict:"A",scope:{event:"=historyEvent"},link:function(c,d){function e(a){return a&&"object"==typeof a&&(c.blocked=!0),a||"nothing"}var f='          <span            class="text"            token="token"            colorize="true"            click="true"            hover="true">          </span>        ';c.token=c.event.token,c.id=c.token.id,c.type=c.event.type,c.trslKey={start:"history."+c.type+".start",end:"history."+c.type+".end"},"change"===c.type&&(c.blocked=!1,c.property=c.event.property,c.oldVal=e(c.event.oldVal),c.newVal=e(c.event.newVal)),c.formatId=function(b){return a.formatId(b,"%w")},d.find("#token").append(b(f)(c))},templateUrl:"templates/arethusa.history/history_event.html"}}]),angular.module("arethusa.history").directive("historyList",["history","$compile",function(a){return{restrict:"A",scope:{},link:function(b){b.history=a,b.events=a.events,b.$watch("history.position",function(a){b.position=a})},templateUrl:"templates/arethusa.history/history_list.html"}}]),angular.module("arethusa.history").service("history",["configurator","keyCapture","state",function(a,b,c){function d(){a.getConfAndDelegate(k),k.maxSize=k.maxSize||20}function e(a){c.doSilent(a),g()}function f(){return k.events[k.position]}function g(){var a=k.events.length>0;k.canUndo=a&&k.position<k.events.length,k.canRedo=a&&k.position>0}function h(a,b){var d=a.id;this.token=a,this.type=b,this.time=new Date,"add"===b?(this.exec=function(){c.addToken(a,d)},this.undo=function(){c.removeToken(d)}):(this.exec=function(){c.removeToken(d)},this.undo=function(){c.addToken(a,d)})}function i(){function a(){angular.forEach(d.events,function(a){a.exec()})}function b(){angular.forEach(d.events,function(a){a.undo()})}var d=this;this.events=[],this.type="batch",this.push=function(a){d.events.push(a)},this.count=function(){return d.events.length},this.pop=function(){return d.events.pop()},this.exec=function(){c.doBatched(a)},this.undo=function(){c.doBatched(b)}}function j(){var a=b.initCaptures(function(a){return{history:[a.create("undo",k.undo,":"),a.create("redo",k.redo,"'")]}});k.activeKeys=angular.extend({},a.history)}var k=this;this.name="history",this.undo=function(){k.canUndo&&e(function(){f().undo(),k.position++})},this.redo=function(){k.canRedo&&e(function(){k.position--,f().exec()})};var l=new i;this.saveEvent=function(a){if(!c.silent){if(c.batchChange)return void l.push(a);var b=k.events;b.length===k.maxSize&&b.pop(),b.splice(0,k.position),k.position=0,b.unshift(a),g()}},c.watch("*",function(a,b,c){k.saveEvent(c)}),c.on("tokenAdded",function(a,b){var c=new h(b,"add");k.saveEvent(c)}),c.on("tokenRemoved",function(a,b){var c=new h(b,"remove");k.saveEvent(c)}),c.on("batchChangeStop",function(){if(!c.silent){var a=1===l.count()?l.pop():l;k.saveEvent(a),l=new i}}),this.init=function(){j(),d(),k.canRedo=!1,k.canUndo=!1,k.events=[],k.position=0}}]),angular.module("arethusa.history").run(["$templateCache",function(a){"use strict";a.put("templates/arethusa.history/history_batch.html",'<span ng-repeat="e in events" history-event="e"/>\n'),a.put("templates/arethusa.history/history_event.html",'<div>\n  <span\n    translate="{{ trslKey.start }}"\n    translate-value-property="{{ property }}">\n  </span>\n  <span id="token"/>\n  <sup class="note"> {{ formatId(id) }} </sup>\n  <span\n    translate="{{ trslKey.end }}"\n    translate-value-property="{{ property }}">\n  </span>\n  <span ng-if="type === \'change\' && !blocked">\n    <span\n      translate="history.fromTo"\n      translate-value-from="{{ oldVal }}"\n      translate-value-to="{{ newVal }}">\n    </span>\n  </span>\n</div>\n'),a.put("templates/arethusa.history/history_list.html",'<div class="small-12 columns">\n  <ol reversed>\n    <p ng-if="events.length === 0" class="text">\n      <span translate="history.noRecords"/>\n    </p>\n    <li\n      ng-repeat="e in events"\n      ng-class="{ \'current-hist-event\': $index === position }"\n      class="text hist-event">\n      <span ng-switch="e.type" >\n        <span ng-switch-when="batch" history-batch="e"/>\n        <span ng-switch-default history-event="e"/>\n      </span>\n    </li>\n  </ol>\n</div>\n')}]),angular.module("arethusa",["angulartics","angulartics.google.analytics","mm.foundation","ngRoute","arethusa.core","arethusa.contextMenu","arethusa.history"]),angular.module("arethusa").config(["$routeProvider","$translateProvider","localStorageServiceProvider","LOCALES","MAIN_ROUTE","LANDING",function(a,b,c,d,e,f){aU.isArethusaMainApplication()&&(a.when("/",f),a.when("/:conf",e));for(var g={},h=d.length-1;h>=0;h--){var i=d[h];g[i+"_*"]=i}b.useStaticFilesLoader({prefix:arethusa.basePath+"/dist/i18n/",suffix:".json"}).registerAvailableLanguageKeys(d,g).determinePreferredLanguage().fallbackLanguage("en"),c.setPrefix("arethusa")}]),angular.module("arethusa").value("CONF_PATH","../dist/configs");var arethusa=new Arethusa;angular.module("arethusa").factory("ConstituentTreebankRetriever",["configurator","documentStore","retrieverHelper","idHandler","globalStore","commons",function(a,b,c,d,e,f){function g(a,b){p(),o();var c=new n,d=h(a.book.sentence,c,b);return angular.extend(e.constituents,c.container),d}function h(a,b,c){return aU.toAry(a).map(function(a){return i(a,b,c)})}function i(a,b,d){var e=a._ID,g=q(),h=new n,i=a.wg;i._role="sent",j(i,d,g,b,h);var k=f.sentence(h.container),l=Object.keys(k.tokens).sort();return k.tokens[l[l.length-1]].terminator=!0,c.generateId(k,g,e,d),k}function j(a,b,c,d,e,g){var h=a._nodeId,i=f.constituent(a._class,a._role,h,c,g);d.add(i),angular.forEach(aU.toAry(a.wg),function(a){j(a,b,c,d,e,h)}),angular.forEach(aU.toAry(a.w),function(a){k(a,b,c,e,h)})}function k(a,b,e,g,h){var i=f.token(a.__text,e),j=a._morphId,k=d.getId(r(j),e);c.generateId(i,k,j,b),l(i,a),m(i,a,h),g.add(i)}function l(a,b){var c,d,e,f={};for(c in t)d=t[c]||c,e=b["_"+c],e&&(f[d]=e);a.morphology={lemma:b._lemma,attributes:f}}function m(a,b,c){a.constituency={parent:c,role:b._role}}function n(){var a=this;this.container={},this.add=function(b){a.container[b.id]=b}}function o(){e.constituents||(e.constituents={})}function p(){s=0}function q(){return s+=1}function r(a){return a.substr(a.length-3)}var s,t={"class":"pos",person:"pers",number:"num",tense:null,mood:null,voice:null,gender:"gend","case":null,degree:null};return function(c){var d=this,e=a.provideResource(c.resource),h=c.docIdentifier;this.parse=function(a,c){var d=arethusaUtil.xml2json(a);b.addDocument(h,f.doc(a,d)),c(g(d,h))},this.get=function(a){e.get().then(function(b){b.data;d.parse(b.data,a)})}}}]),angular.module("arethusa").factory("HebrewPersister",["documentStore","configurator","navigator","idHandler",function(a,b){return function(c){function d(){}function e(){}function f(){return a.store[h]}var g=b.provideResource(c.resource),h=c.docIdentifier;this.saveData=function(a,b){d(),e(),g.save(f().xml,"text/xml").then(a,b)}}}]),angular.module("arethusa").factory("HebrewRetriever",["documentStore","configurator","idHandler","languageSettings","hebrewMorph",function(a,b,c,d,e){return function(f){function g(a,b,c,d){this.id=a,this.string=b,this.idMap=c,this.terminator=d}function h(a){var b=/^ref\.(\d+\.){3}(\d+)\.(\d+)$/.exec(a),d=c.getId(b[2])+"-"+c.getId(b[3]),e=a,f=new c.Map;return f.add(l,d,e),{map:f,id:d}}function i(a){var b={};return angular.forEach(arethusaUtil.toAry(a.sentence),function(a){var c=arethusaUtil.toAry(a.token),d=c.length-1;angular.forEach(c,function(a,c){var f=h(a._id),i=a._surface,j=c===d,k=f.id,l=new g(k,i,f.map,j);e.parse(a,l),b[k]=l})}),b}function j(a){var b=arethusaUtil.toAry(a.corpus.article.paragraph);return arethusaUtil.map(b,function(a){var b=a._id,c=i(a);return{id:b,tokens:c}})}var k=b.provideResource(f.resource),l=f.docIdentifier;this.getData=function(b){d.setFor(l,"heb"),k.get().then(function(c){var d=c.data,e=arethusaUtil.xml2json(c.data);a.addDocument(l,{json:e,xml:d}),b(j(e,l))})}}}]),angular.module("arethusa").factory("PhaidraTreebankRetriever",["configurator","documentStore","retrieverHelper","idHandler","languageSettings","locator","commons",function(a,b,c,d,e,f,g){function h(a,b){for(var e="1",f={},h=a.words,j=0;j<h.length;j++){var k=h[j],l=g.token(k.value,e),m=d.getId(k.tbwid,e);c.generateId(l,m,k.CTS,b);var n=k.head;angular.isDefined(n)&&(l.head={id:d.getId(n,e)});var o=k.relation;o&&(l.relation={label:o}),l.morphology={lemma:k.lemma,attributes:i(k)},f[l.id]=l}var p=g.sentence(f,a.CTS);return c.generateId(p,e,e,b),[p]}function i(a){var b,c,d,e={};for(b in k)c=k[b]||b,d=a[b],d&&(e[c]=d);return e}function j(a){return a.words[0].lang}var k={pos:null,person:"pers",number:"num",tense:null,mood:null,voice:null,gender:"gend","case":null,degree:null};return function(d){var f=a.provideResource(d.resource),i=d.docIdentifier;this.preselections=c.getPreselections(d),this.get=function(a){f.get().then(function(c){var d=c.data;b.addDocument(i,g.doc(null,d,null)),e.setFor(i,j(d)),a(h(d,i))})}}}]),angular.module("arethusa").service("retrieverHelper",["idHandler","locator",function(a,b){this.generateId=function(b,c,d,e){var f=new a.Map;f.add(e,c,d),b.id=c,b.idMap=f},this.getPreselections=function(c){var d=aU.toAry(b.get(c.preselector));return arethusaUtil.map(d,function(b){return a.getId(b)})}}]),angular.module("arethusa").factory("TreebankPersister",["documentStore","configurator","navigator","idHandler",function(a,b,c,d){return function(e){function f(){l().xml=arethusaUtil.json2xml(l().json)}function g(a,b,c){var d=b.head;d&&d.id?a._head=c[d.id]||0:angular.isDefined(a._head)&&(a._head="");var e=b.relation;e?a._relation=e.label:a._relation&&(a._relation="");var f=b.morphology;f?(angular.isDefined(f.lemma)&&(a._lemma=f.lemma),angular.isDefined(f.postag)&&(a._postag=f.postag),angular.isDefined(f.gloss)&&(a._gloss=f.gloss)):(a._lemma||a._postag)&&(a._lemma=a._postag="");var g=b.sg;g?a._sg=arethusaUtil.map(g.ancestors,function(a){return a.short}).join(" "):a._sg&&(a._sg=""),a._form=b.string}function h(a,b,c){this._id=a,this._insertion_id=b.split("-")[1],this._artificial=c||"elliptic"}function i(){return m++,m}function j(a,b){var c=a[b._id];if(c.changed){var e=arethusaUtil.toAry(b.word);m=e[e.length-1]._id;var f=d.transformToSoureIds(c.tokens,p,i),j=f.mapped,k=f.fullMap,l=[];angular.forEach(e,function(a,b){var c=j[a._id];c?g(a,c,k):l.unshift(b)}),angular.forEach(l,function(a){e.splice(a,1)}),angular.forEach(f.unmapped,function(a){var b=a.id,c=a.idMap.sourceId(p),d=new h(c,b);g(d,a,k),e.push(d),a.idMap.add(p,b,m)})}}function k(){var a=arethusaUtil.toAry(l().json.treebank.sentence),b=c.sentencesById;angular.forEach(a,function(a){j(b,a)})}function l(){return a.store[p]}var m,n=this,o=b.provideResource(e.resource),p=e.docIdentifier;this.output=function(a){k(),f();var b=l().xml;return a?b:aU.formatXml(b)},this.saveData=function(a,b){o.save(n.output(!0),n.mimeType).then(a,b)},this.identifier=p,this.mimeType="text/xml",this.fileType="xml"}}]),angular.module("arethusa").factory("TreebankRetriever",["configurator","documentStore","retrieverHelper","idHandler","commons","editors",function(a,b,c,d,e,f){function g(a,b){var c=arethusaUtil.toAry(a.treebank.annotator||[]);h(c,b);var d=arethusaUtil.toAry(a.treebank.sentence);return i(d,b)}function h(a,b){angular.forEach(a,function(a){w(a)&&f.addEditor(b,{name:a.short,fullName:a.name,page:a.url,mail:a.address})})}function i(a,b){return a.map(function(a){{var c=u(a);arethusaUtil.toAry(a.word)}return j(a,a._id,b,c)})}function j(a,b,d,f){var g=aU.toAry(a.word),h={},i=q(g,b),j=g.length-1;angular.forEach(g,function(a,c){var e=k(a,b,d,i);c===j&&(e.terminator=!0),h[e.id]=e});var l=e.sentence(h,f);return c.generateId(l,b,b,d),l}function k(a,b,d,f){var g=e.token(a._form,b);m(g,a),n(g,a),o(g,a),p(g,a),l(g,a,f);var h=s(a,b),i=a._id;return c.generateId(g,h,i,d),g}function l(a,b,c){var e=b._head;if(angular.isDefined(e)&&""!==e){var f={},g=c[e],h=a.sentenceId;f.id=g?g:d.getId(e,h),a.head=f}}function m(a,b){a.morphology={lemma:b._lemma,postag:b._postag};var c=b._gloss;c&&(a.morphology.gloss=c)}function n(a,b){var c=b._relation,d=c&&"nil"!==c?c:"";a.relation={label:d}}function o(a,b){var c=b._sg;c&&!c.match(/^\s*$/)&&(a.sg={ancestors:c.split(" ")})}function p(a,b){b._artificial&&(a.artificial=!0,a.type=b._artificial)}function q(a,b){return arethusaUtil.inject({},a,function(a,c){r(a,c,b)})}function r(a,b,c){b._artificial&&(a[b._id]=t(b._insertion_id,c))}function s(a,b){return a._artificial?t(a._insertion_id,b):d.getId(a._id,b)}function t(a,b){return a.match(/-/)?a:d.padIdWithSId(a,b)}function u(a){var b=a._cite;if(b)return b;var c=a._document_id,d=a._subdoc;return d?c+":"+d:c}function v(a){var b=a.treebank.link,c=b?arethusaUtil.toAry(b):[],d=arethusaUtil.inject({},c,function(a,b){a[b._title]=b._href}),e=a.treebank._format;return e&&("aldt"==e&&(e="aldt2"+a.treebank["_xml:lang"]),d.fullFile=e),d}function w(a){return a.name&&a.short}return function(d){var f=this,h=a.provideResource(d.resource),i=d.docIdentifier;this.preselections=c.getPreselections(d),this.parse=function(a,c){var d=arethusaUtil.xml2json(a),f=v(d),h=e.doc(a,d,f);b.addDocument(i,h),c(g(d,i))},this.get=function(a){h.get().then(function(b){f.parse(b.data,a)})}}}]),angular.module("arethusa").constant("VERSION",{revision:"4d10285cfa859c712dd9686d961d4a047961d89f",branch:"bower-release",date:"2014-12-16T19:22:58.477Z",repository:"http://github.com/latin-language-toolkit/arethusa"}),angular.module("arethusa").run(["$templateCache",function(a){"use strict";a.put("templates/conf_editor.html",'<arethusa-navbar></arethusa-navbar>\n\n<div class="row panel">\n  <div class="colums small-12">\n    <h3>Conf editor</h3>\n      <strong>{{ fileName() }}</strong>\n    <div>\n      <ul class="button-group right">\n        <li><button ng-click="save()" class="small">Save</button></li>\n        <li><button ng-clikc="saveAs()" class="small">Save as...</button></li>\n        <!--needs something like dropdown where we can enter a new filename-->\n        <li><button ng-click="reset()" class="small">Reset</button></li>\n        <li><button ng-click="toggleDebugMode()" class="small">Debug</button></li>\n      </ul>\n    </div>\n  </div>\n  <div debug="conf"></div>\n</div>\n\n<div class="row panel">\n  <div class="columns large-12">\n    <div class="columns large-3">\n      <simple-form text="Main Template" model="main().template"></simple-form>\n      <input type="checkbox" ng-model="main().colorize"/><label>Colorize tokens</label>\n    </div>\n  </div>\n</div>\n\n<div class="row panel">\n  <h5>Data Sources</h5>\n    <!--this is going to be a directive once the markup takes-->\n    <!--more shape-->\n    <ul class="button-group">\n      <li ng-repeat="(name, conf) in main().retrievers"\n          ng-click="toggleSelection(\'source\', name)">\n        <span class="tiny button">\n          {{ name }}\n        </span>\n      </li>\n    </ul>\n    <div ng-repeat="(name, conf) in main().retrievers" ng-show="isSelected(\'source\', name)">\n      <!--\n        Note on the remover attribute: We pass a function here through a\n        one-way binding here. This function takes an argument, in this case\n        removePlugin() takes the name of the plugin to remove. The name of this\n        param in the attribute declaration is meaningless. It\'s just here to tell\n        the pluginConf directive (which is in an isolated scope) that the function\n        in fact takes an argument. It wouldn\'t need to be name here, it could be\n        \'foo\' too.\n      -->\n      <retriever-conf\n        name="name"\n        retriever="main().retrievers[name]"\n        remover="removeDataSource(name)">\n      </retriever-conf>\n    </div>\n    <conf-adder\n      text="Add a data source"\n      submitter="addDataSource(input)">\n    </conf-adder>\n</div>\n\n<div class="row panel">\n  <h5>Plugins</h5>\n  <div>\n    <ul class="button-group">\n      <li ng-repeat="name in main().plugins">\n        <span\n          class="tiny button"\n          ng-class="{alert: isMainPlugin(name)}"\n          ng-click="toggleSelection(\'plugin\', name)">\n          {{ name }}\n        </span>\n      </li>\n    </ul>\n  </div>\n  <div ng-repeat="name in main().plugins" ng-show="isSelected(\'plugin\', name)">\n    <plugin-conf name="name"></plugin-conf>\n  </div>\n  <conf-adder\n    text="Add a plugin"\n    submitter="addPlugin(input)">\n  </conf-adder>\n</div>\n\n<div class="row panel">\n  <h5>Resources</h5>\n  <div>\n    <ul class="button-group">\n      <li ng-repeat="(name, resource) in resources()">\n        <span class="tiny button" ng-click="toggleSelection(\'resource\', name)">\n          {{ name }}\n        </span>\n      </li>\n    </ul>\n  </div>\n  <div ng-repeat="(name, resource) in resources()" ng-show="isSelected(\'resource\', name)">\n    <resource-conf\n      name="name"\n      resource="resource"\n      remover="removeResource(name)">\n    </resource-conf>\n  </div>\n  <conf-adder\n    text="Create a resource"\n    submitter="addResource(input)">\n  </conf-adder>\n</div>\n\n<div class="row panel">\n  <h5>Navbar</h5>\n  <div class="columns large-3">\n    <simple-form text="Template" model="navbar().template"></simple-form>\n    <span ng-repeat="key in navbarBooleans">\n      <input type="checkbox" ng-model="navbar()[key]"/><label>{{ key }}</label>\n    </span>\n  </div>\n</div>\n'),a.put("templates/dep_tree.html",'<div class="tree-canvas">\n  <div class="tree-settings">\n    <span\n      class="note right settings-span-button"\n      ng-show="plugin.diffPresent"\n      ng-click="plugin.toggleDiff()">\n      Toggle Diff\n    </span>\n    <span\n      class="note right settings-span-button"\n      style="margin-left: 10px"\n      unused-token-highlighter\n      uth-check-property="head.id">\n    </span>\n  </div>\n\n  <div\n    lang-specific\n    dependency-tree\n    tokens="state.tokens"\n    styles="plugin.diffStyles()"\n    to-bottom>\n  </div>\n</div>\n'),a.put("templates/dep_tree2.html",'<div>\n  <div class="tree-settings">\n    <span\n      class="note right settings-span-button"\n      ng-show="plugin.diffPresent"\n      ng-click="plugin.toggleDiff()">\n      Toggle Diff\n    </span>\n    <span\n      class="note right settings-span-button"\n      style="margin-left: 10px"\n      unused-token-highlighter\n      uth-check-property="head.id">\n    </span>\n  </div>\n\n  <div\n    lang-specific\n    dependency-tree\n    tokens="state.tokens"\n    styles="plugin.diffStyles()"\n    to-bottom>\n  </div>\n</div>\n'),a.put("templates/exercise_demo.html",'<arethusa-navbar></arethusa-navbar>\n<p/>\n<div id="canvas" class="row panel full-height" full-height>\n  <div id="main-body" class="columns small-7">\n    <div ng-repeat="pl in mainPlugins">\n      <plugin name="pl"/>\n    </div>\n  </div>\n\n  <div id="sidepanel" class="columns small-5">\n    <div id="sidepanel-resizer" full-height resizable></div>\n    <div id="sidepanel-body">\n      <tabset>\n        <tab\n          ng-click="declareActive(pl.name)"\n          ng-repeat="pl in subPlugins"\n          heading="{{ pl.name }}">\n          <plugin name="pl" ng-if="isActive(pl)"/>\n        </tab>\n      </tabset>\n    </div>\n  </div>\n</div>\n'),a.put("templates/external_history.html",'<p>(jQuery implementation)</p>\n\n<span id="undo" class="label radius">Undo</span>\n<span id="redo" class="label radius">Redo</span>\n<div id="ext-hist-elements"></div>\n\n<script src="./js/other/external_history.js"></script>\n'),a.put("templates/history.html",'<div>\n  <span class="settings-span-button right" hist-redo/>\n  <span class="settings-span-button right" hist-undo/>\n  <div delimiter/>\n  <div history-list/>\n</div>\n'),a.put("templates/landing_page.html",'<arethusa-navbar></arethusa-navbar>\n\n<div class="canvas-border"></div>\n\n<div class="panel row large-12 columns">\n  <div class="section">\n    <a href="https://github.com/latin-language-toolkit/arethusa"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"/></a>\n    <p class="italic"><span translate="landing.description"/></p>\n\n    <div style="margin: auto">\n      <img src="../dist/examples/images/grid.png" style="height: 650px; display: block; margin: auto"/>\n    </div>\n  </div>\n\n  <div class="large-12 columns" style="padding: 1rem 0"/>\n\n  <div class=section>\n    <h3><span translate="useCases"/></h3>\n    <p><span translate="landing.modularNature"/></p>\n\n    <div class="large-12 columns">\n      <div ng-repeat="useCase in useCases">\n        <h3 class="italic"><span translate="{{ useCase.name }}"/></h4>\n        <div ng-repeat="example in useCase.examples">\n          <div\n            class="large-4 columns panel clickable"\n            ng-click="goTo(example.url)">\n            <h4>{{ example.name }}</h4>\n            <img ng-src="{{ example.img }}"/>\n            <p>{{ example.caption }}</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="large-12 columns" style="padding: 1rem 0"/>\n\n  <div class="section">\n    <h3><span translate="gettingStarted"/></h3>\n    <iframe width="640" height="360" src="//www.youtube.com/embed/FbRRoVnVuDs" frameborder="0" allowfullscreen></iframe>\n    <iframe width="640" height="360" src="//www.youtube.com/embed/hp-bhasd96g" frameborder="0" allowfullscreen></iframe>\n    <p>\n    <a href="http://sites.tufts.edu/perseids/instructions/screencasts/"><span translate="landing.moreScreencasts"/></a>\n    </p>\n  </div>\n\n  <div class="large-12 columns" style="padding: 1rem 0"/>\n\n  <div class="section">\n    <h3><span translate="development"/></h3>\n    <p><span translate="landing.devDescription"/></p>\n  </div>\n\n  <div class="large-12 columns" style="padding: 1rem 0"/>\n\n  <div style="section">\n    <h3><span translate="landing.partners"/></h3>\n    <div class="large-12 columns">\n      <div class="img-container" style="display: inline-block">\n        <a href="{{ partners[0].href }}">\n          <img class="center" style="height: 200px" ng-src="{{ partners[0].img }}"/>\n        </a>\n      </div>\n      <div class="img-container" style="display: inline-block">\n        <a href="{{ partners[1].href }}">\n          <img class="center" style="height: 150px" ng-src="{{ partners[1].img }}"/>\n        </a>\n      </div>\n      <div class="img-container" style="display: inline-block">\n        <a href="{{ partners[2].href }}" target="_blank">\n          <img class="center" style="height: 70px; margin: 2rem" ng-src="{{ partners[2].img }}"/>\n        </a>\n      </div>\n      <div class="img-container" style="display: inline-block">\n        <a href="{{ partners[3].href }}" target="_blank">\n          <img class="center" style="height: 200px" ng-src="{{ partners[3].img }}"/>\n        </a>\n      </div>\n    </div>\n    <p>\n  </div>\n\n  <div class="large-12 columns" style="padding: 1rem 0"/>\n\n  <div>\n    <h3><span translate="landing.funders"/></h3>\n    <p><span translate="landing.fundersDescription"/></p>\n  </div>\n</div>\n\n'),a.put("templates/main.html",'<div class="row panel">\n  <div class="columns small-12">\n    <h3>Main Controller</h3>\n    Selected tokens: {{ state.currentTokensAsStringList() }}\n  </div>\n</div>\n\n<div ng-repeat="pl in plugins" class="row panel">\n  <div class="columns small-12">\n    <plugin name="{{ pl }}"/>\n  </div>\n</div>\n'),a.put("templates/main2.html",'<arethusa-navbar></arethusa-navbar>\n\n<div class="row panel">\n  <div class="columns small-12">\n    <div>\n      <h3>Main State</h3>\n      <p>\n        {{ state.selectedTokens }}\n        <button deselector class="right small">Deselect all</button>\n        <button ng-click="toggleDebugMode()" class="right small">Debug</button>\n      </p>\n    </div>\n    <div debug="state.tokens"></div>\n  </div>\n</div>\n\n\n<div class="row panel full-height">\n  <div class="columns small-6">\n    <div ng-repeat="pl in mainPlugins">\n      <plugin name="pl"/>\n      <hr>\n    </div>\n  </div>\n\n  <div class="columns small-6">\n    <tabset>\n      <tab ng-repeat="pl in subPlugins" heading="{{ pl.name }}">\n        <plugin name="pl"/>\n      </tab>\n    </tabset>\n  </div>\n</div>\n'),a.put("templates/main3.html",'<arethusa-navbar></arethusa-navbar>\n\n<div class="canvas-border"></div>\n\n<div class="panel">\n<a href="https://github.com/latin-language-toolkit/arethusa"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>\n<h3>Arethusa</h3>\n<p>TODO description</p>\n\n<h3>Use cases or configurations</h3>\n<p>Through its modular nature Arethusa can be configured for different use cases:<p>\nTODO\n<div class="row" data-equalizer>\n  <div class="large-4 columns panel" data-equalizer-watch>\n    <h4>Treebanking</h4>\n    TODO description\n    <a href="/app/#/staging2?doc=1&s=2">Example</a>\n    TODO image\n  </div>\n  <div class="large-4 columns panel" data-equalizer-watch>\n    <h4>Review mode</h4>\n    <a href="/app/#/review_test?doc=1&gold=11">Example</a>\n  </div>\n  <div class="large-4 columns panel" data-equalizer-watch>\n    <h4>Review mode</h4>\n    <a href="/app/#/review_test?doc=1&gold=11">Example</a>\n  </div>\n</div>\nThe new Grid layout\nhttp://localhost:8081/app/#/staging3?doc=1\n\n\n\nA Greek document, including the SG plugin\nhttp://localhost:8081/app/#/sg?doc=athenaeus12&s=1\n\nAn empty document to play around (saving disabled)\nhttp://localhost:8081/app/#/clean?doc=clean1\n\n<h3>Getting started</h3>\n<iframe width="640" height="360" src="//www.youtube.com/embed/FbRRoVnVuDs" frameborder="0" allowfullscreen></iframe>\n<iframe width="640" height="360" src="//www.youtube.com/embed/hp-bhasd96g" frameborder="0" allowfullscreen></iframe>\n<p>\n<a href="http://sites.tufts.edu/perseids/instructions/screencasts/">More screencasts</a>\n</p>\n\n<h3>Development</h3>\n<p>\nArethusa is built on the <a href="https://angularjs.org/angular.js">AngularJS</a> javascript web application framework \nand provides a back-end independent plugin infrastructure for accessing texts, annotations and linguistic services from a variety of sources. \nExtensibility is a guiding design goal - Arethusa includes tools for automatic generation of new plugin skeletons \n(<a href="https://github.com/latin-language-toolkit/arethusa-cli">Arethusa::CLI</a>) and detailed development guides are currently in progress (TODO link?), \nwith the hopes that others will be able to reuse and build upon the platform to add support for other annotation types, \nlanguages and back-end repositories and workflow engines.\n</p>\n\n\n<h3>Funders</h3>\n<p>This project has received support from the <a href="http://www.mellon.org/">Andrew W. Mellon Foundation</a> and the <a href="http://imls.gov/">Institute of Museum and Library Services</a>.</p>\n</div>\n\n'),a.put("templates/main_grid.html",'<div>\n  <div id="arethusa-editor">\n    <div class="canvas-border"/>\n\n    <div arethusa-grid/>\n\n    <div arethusa-context-menus tokens="state.tokens" plugins="plugins.withMenu"/>\n  </div>\n  <div notifications/>\n  <div id="arethusa-sentence-list" class="hide"/>\n</div>\n'),a.put("templates/main_with_sidepanel.html",'<div>\n  <div id="arethusa-editor">\n    <div class="canvas-border"/>\n\n    <div id="canvas" class="row panel full-height" full-height>\n      <div id="main-body" to-bottom>\n        <div ng-repeat="pl in plugins.main" plugin name="{{ pl.name }}"/>\n        <div keys-to-screen/>\n      </div>\n\n      <div id="sidepanel" sidepanel to-bottom class="scrollable">\n        <div id="sidepanel-resizer" resizable to-bottom></div>\n        <div id="sidepanel-body" arethusa-tabs="plugins.sub"/>\n      </div>\n    </div>\n\n    <div arethusa-context-menus tokens="state.tokens" plugins="plugins.withMenu"/>\n  </div>\n  <div notifications/>\n  <div id="arethusa-sentence-list" class="hide"/>\n</div>\n'),a.put("templates/morph.html",'<h3>Morph plugin</h3>\n<ul>\n  <li ng-repeat="analysis in plugin.currentAnalyses()">\n    Forms of {{ analysis.string}}\n    <ol>\n      <li ng-repeat="form in analysis.forms">\n        <morph-form></morph-form>\n      </li>\n    </ol>\n  </li>\n</ul>\n'),a.put("templates/morph2.html",'<div class="right">\n  <prev-token><span class="label radius">prev</span></prev-token>\n  <next-token><span class="label radius">next</span></next-token>\n</div>\n\n<!--{{ plugin.analyses }}-->\n\n<div ng-repeat="(id, analysis) in plugin.currentAnalyses()">\n  <p token-with-id value="analysis.string" token-id="id"/>\n  <accordion close-others="oneAtATime">\n    <accordion-group ng-repeat="form in analysis.forms" >\n      <accordion-heading>\n         <div class="row">\n           <div class="columns small-5">\n             • <span ng-style="plugin.styleOf(form)">{{ form.lemma }}\n             <br>\n             </span> {{ plugin.concatenatedAttributes(form) }}\n           </div>\n           <div class="columns small-2">{{ form.postag }}</div>\n           <div class="columns small-2 note">{{ form.origin }}</div>\n           <div form-selector class="columns small-2 right end"></div>\n         </div>\n      </accordion-heading>\n      <morph-form-edit></morph-form-edit>\n    </accordion-group>\n    <accordion-group heading="Create new form">\n      <morph-form-create></morph-form-create>\n    </accordion-group>\n  </accordion>\n</div>\n'),a.put("templates/morph3.html",'<div ng-repeat="(id, analysis) in plugin.currentAnalyses()">\n  <div class="small-12 columns" lang-specific>\n    <p token-with-id value="analysis.string" token-id="id"/>\n    <p ng-if="plugin.gloss">\n      <label>\n        <span translate="morph.lemmaTranslation"/>\n        <input class="compact"\n          type="text"\n          ng-change="plugin.updateGloss(id)"\n          ng-model="analysis.gloss">\n        </input>\n      </label>\n    </p>\n    <accordion close-others="oneAtATime">\n      <accordion-group\n        ng-repeat="form in analysis.forms"\n        is-open="plugin.expandSelection && form.selected">\n        <accordion-heading>\n          <div class="row" accordion-highlighter>\n            <div form-selector class="columns large-1 small-1"></div>\n            <div class="columns large-3 small-5 text">\n              <span ng-style="plugin.styleOf(form)" lang-specific>{{ form.lemma }}\n              <br>\n              </span> {{ plugin.concatenatedAttributes(form) }}\n            </div>\n            <div\n              class="columns large-4 small-5 postag">\n              {{ form.postag }}\n            </div>\n            <div class="columns large-1 hide-for-small hide-for-medium note end">{{ form.origin }}</div>\n          </div>\n          <hr class="small">\n        </accordion-heading>\n        <div class="small-12 columns" morph-form-attributes="form" token-id="id"></div>\n        <p class="small-12 columns"/>\n        <hr>\n      </accordion-group>\n    </accordion>\n  </div>\n  <div ng-if="plugin.canEdit()">\n    <div class="small-6 columns">\n      <button\n        reveal-toggle="mfc{{ id }}"\n        class="micro radius">\n        <span translate="morph.createNewForm"/>\n      </button>\n    </div>\n    <morph-form-create\n      id="mfc{{ id }}"\n      morph-id="id"\n      morph-token="analysis"\n      class="hide">\n    </morph-form-create>\n  </div>\n  <div delimiter/>\n</div>\n'),a.put("templates/morph_form.html",'<ul>\n  <li ng-repeat="(attr, val) in form.attributes">\n    {{ plugin.longAttributeName(attr) }}: {{ plugin.abbrevAttributeValue(attr, val) }}\n  </li>\n</ul>\n'),a.put("templates/morph_form_create.html",'<div class="small-6 columns">\n  <ul class="button-group right">\n    <li>\n      <span\n        class="button micro radius"\n        ng-click="reset()"\n        translate="reset">\n      </span>\n    </li>\n    <li>\n      <span\n        class="button micro radius"\n        ng-click="save(mFCForm.$valid)"\n        translate="save">\n      </span>\n    </li>\n  </ul>\n</div>\n\n<div delimiter></div>\n\n<form name="mFCForm">\n  <div class="small-12 columns">\n    <alert\n      ng-if="alert"\n      class="radius center fade-in error"\n      close="resetAlert()">\n      {{ translations.createError }}\n    </alert>\n  </div>\n\n  <div class="small-12 columns">\n    <div class="small-3 columns">\n      <label class="right">Lemma</label>\n    </div>\n    <div class="small-9 columns">\n      <ng-form\n        id="lemma-form"\n        tooltip-placement="top"\n        tooltip="{{ lemmaHint }}">\n        <input\n          foreign-keys\n          class="compact error"\n          type="text"\n          required\n          ng-change="declareOk()"\n          ng-model="form.lemma">\n        </input>\n      </ng-form>\n    </div>\n  </div>\n\n  <div\n    ng-repeat="attr in visibleAttributes"\n    ng-init="options= m.attributeValues(attr)">\n    <div class="small-12 columns">\n      <div class="small-3 columns">\n        <label class="right">{{ m.longAttributeName(attr) }}</label>\n      </div>\n\n      <div class="small-9 columns">\n        <select\n          class="compact"\n          required\n          ng-model="form.attributes[attr]"\n          ng-options="options[key].long for key in options | keys"\n          ng-change="m.updatePostag(form, attr, form.attributes[attr])">\n        </select>\n      </div>\n    </div>\n  </div>\n</form>\n'),a.put("templates/morph_form_edit.html",'<div class="row" ng-repeat="(attr, val) in form.attributes">\n  <div class="small-3 columns">\n    <label class="right">{{ plugin.longAttributeName(attr) }}</label>\n  </div>\n\n  <div class="small-9 columns">\n    <select\n      ng-model="form.attributes[attr]"\n      ng-init="opt.short"\n      ng-options="name as opt.long for (name, opt) in plugin.attributeValues(attr)"\n'+"      fire-event=\"{target: 'form', property: 'attr', value: 'val'}\"\n      synchronize-postag=\"{form: 'form', attr: 'attr', val: 'val'}\">\n    </select>\n  </div>\n</div>\n<small ng-show=\"form.lexInvUri\">Lexical Inventory: {{ form.lexInvUri }}</small>\n"),a.put("templates/navbar1.html",'<div class="fixed">\n  <nav class="top-bar" data-topbar>\n    <ul class="title-area">\n      <li class="name">\n      <h1><a href="#"><img ng-src="{{ logo }}"/></a></h1>\n      </li>\n    </ul>\n    <section class="top-bar-section">\n      <ul navbar-search/>\n      <ul navbar-navigation/>\n      <ul navbar-buttons class="right"/>\n    </section>\n  </nav>\n</div>\n<div help-panel class="hide row panel"/>\n<div global-settings-panel class="hide row panel"/>\n'),a.put("templates/navbar_landing.html",'<div class="fixed">\n  <nav class="top-bar" data-topbar>\n    <ul class="title-area">\n      <li class="name">\n      <h1><a href="#"><img ng-src="{{ logo }}"/></a></h1>\n      </li>\n    </ul>\n    <section class="top-bar-section">\n      <ul class=" has-form right">\n        <li><a class="button" translate-language/></li>\n      </ul>\n    </section>\n  </nav>\n</div>\n'),a.put("templates/relation.html",'<div\n  class="note right span-settings-button"\n  style="margin-top: 10px"\n  unused-token-highlighter\n  uth-check-property="relation.label">\n</div>\n\n<div ng-if="plugin.advancedMode">\n  <div relation-multi-changer class="small-12 columns"/>\n  <div delimiter/>\n</div>\n\n<div ng-repeat="(id, obj) in plugin.currentLabels()">\n    <div class="small-12 columns" style="padding-bottom: 1rem">\n      <div token-with-id value="obj.string" token-id="id" style="padding-bottom: .4rem"/>\n      <div label-selector obj="obj.relation"/>\n    </div>\n</div>\n\n'),a.put("templates/search.html",'<div class="small-12 columns">\n  <div search-by-string/>\n</div>\n\n<div class="small-12 columns" ng-repeat="pl in plugin.searchPlugins">\n  <div plugin-search="pl"></div>\n</div>\n\n<div class="small-12 columns">\n  <label class="inline">\n    <span translate="search.foundTokens"/>\n  </label>\n  <ul lang-specific>\n    <li\n      ng-repeat="(id, type) in state.selectedTokens"\n      class="fade fast clickable"\n      ng-mouseenter="hovered = true"\n      ng-mouseleave="hovered = false"\n      ng-class="{ \'search-result-hovered\': hovered }"\n      ng-click="state.deselectToken(id, type)"\n      token-with-id\n      value="state.asString(id)"\n      token-id="id">\n    </li>\n  </ul>\n</div>\n'),a.put("templates/sg.html",'<div class="small-12 columns">\n  <div ng-repeat="(id, grammar) in plugin.currentGrammar()">\n    <p token-with-id value="grammar.string" token-id="id"/>\n    <p class="text" style="margin-left: 0.75rem">{{ grammar.hint }}</p>\n    <div ng-hide="grammar.hint">\n      <div sg-ancestors="grammar"/>\n      <br/>\n      <ul ng-if="plugin.canEdit()" class="nested-dropdown">\n        <li class="first-item">Select Smyth Categories\n          <ul\n            class="top-menu"\n            nested-menu-collection\n            property=""\n            current="grammar"\n            ancestors="plugin.defineAncestors"\n            all="grammar.menu"\n            label-as="plugin.labelAs"\n            empty-val="true">\n          </ul>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <div sg-grammar-reader>\n  </div>\n</div>\n'),a.put("templates/text.html",'<h3>Text plugin</h3>\n<table>\n  <tr>\n    <td ng-repeat="token in state.tokens">\n      {{ token.id }}\n    </td>\n  </tr>\n  <tr>\n      <!--this mouse behavior should get moved\n          inside the token directive eventually-->\n    <td\n      ng-repeat="token in state.tokens"\n      ng-click="state.toggleSelection(token.id, \'click\')"\n      ng-mouseenter="state.selectToken(token.id, \'hover\')"\n      ng-mouseleave="state.deselectToken(token.id, \'hover\')">\n      <token ng-class="{selected: state.isSelected(token.id)}"></token>\n    </td>\n  </tr>\n</table>\n'),a.put("templates/text2.html",'<p lang-specific>\n  <span ng-repeat="token in plugin.tokens">\n    <span\n      token="token"\n      colorize="true"\n      click="true"\n      hover="true"\n      highlight="true">\n    </span>\n    <br ng-if="token.terminator && !$last"/>\n  </span>\n</p>\n'),a.put("templates/token.html",'<!--tcm is for tokenContextMenu-->\n<span\n  ng-class="selectionClass()"\n  context-menu\n  menu-trigger="rightclick"\n  menu-id="tcm{{ token.id }}"\n  menu-position="bottom"\n  menu-obj="token">{{ token.string }}</span>\n'),a.put("templates/tree.html",'<arethusa-navbar></arethusa-navbar>\n\n<div class="row panel">\n  <div class="columns small-12">\n    <div>\n      <h3>Main State</h3>\n      <p>\n        {{ state.selectedTokens }}\n        <button deselector class="right small">Deselect all</button>\n        <button ng-click="toggleDebugMode()" class="right small">Debug</button>\n      </p>\n    </div>\n    <div debug="state.tokens"></div>\n  </div>\n</div>\n\n\n<div class="row panel full-height">\n  <div class="columns small-12">\n    <div ng-repeat="pl in mainPlugins">\n      <plugin name="pl"/>\n      <hr>\n    </div>\n  </div>\n</div>\n\n')
}]);
//# sourceMappingURL=arethusa.min.map